(self.webpackChunkmy_projectakhir=self.webpackChunkmy_projectakhir||[]).push([[726],{6726:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AdminModule:()=>Ap});var r=n(1116),i=n(5366);let o=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-dashboard"]],decls:2,vars:0,template:function(t,e){1&t&&(i.TgZ(0,"p"),i._uU(1,"Selamat Datang Di Pendudes Web Application!"),i.qZA())},styles:[""]}),t})();var s=n(766),a=n(7112),u=n(4369),c=n(7307),h=n(168),l=n(667),f=n(7064);let d=(()=>{class t{constructor(){this.mode="side",this.menu=[{name:"Dashboard",icon:"dashboard",url:"/admin/dashboard"}]}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-admin"]],decls:38,vars:8,consts:[[1,"example-header",2,"background-color","red"],["mat-icon-button","",3,"click"],[2,"color","white"],[1,"uk-width-expand"],["mat-button","","routerLink","/open",1,"mini-title"],[1,"example-container"],["mode","side","opened","",1,"sidenav-left",2,"background-color","black",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],["routerLink","/admin/dashboard"],["matListIcon","",2,"color","white"],["matLine","",2,"color","white"],["routerLink","/admin/product"],["routerLink","/admin/tentang"],["mode","side",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-color","#ccc"]],template:function(t,e){if(1&t){const t=i.EpF();i.ynx(0),i.TgZ(1,"mat-toolbar",0),i.TgZ(2,"button",1),i.NdJ("click",function(){return i.CHM(t),i.MAs(17).toggle()}),i.TgZ(3,"mat-icon"),i._uU(4,"menu"),i.qZA(),i.qZA(),i.TgZ(5,"span",2),i._uU(6,"PENDUDES WEB APPLICATION"),i.qZA(),i._UZ(7,"div",3),i.TgZ(8,"button",1),i.NdJ("click",function(){return i.CHM(t),i.MAs(17).toggle()}),i.TgZ(9,"mat-icon"),i._uU(10,"perm_identity"),i.qZA(),i.qZA(),i.TgZ(11,"small",2),i._uU(12,"Admin"),i.qZA(),i.TgZ(13,"button",4),i._uU(14,"LogOut"),i.qZA(),i.qZA(),i.TgZ(15,"mat-sidenav-container",5),i.TgZ(16,"mat-sidenav",6,7),i.TgZ(18,"mat-nav-list"),i.TgZ(19,"mat-list-item",8),i.TgZ(20,"mat-icon",9),i._uU(21,"dashboard"),i.qZA(),i.TgZ(22,"h3",10),i._uU(23,"Dashboard"),i.qZA(),i.qZA(),i.TgZ(24,"mat-list-item",11),i.TgZ(25,"mat-icon",9),i._uU(26,"add"),i.qZA(),i.TgZ(27,"h3",10),i._uU(28,"ADD DATA PENDUDUK"),i.qZA(),i.qZA(),i.TgZ(29,"mat-list-item",12),i.TgZ(30,"mat-icon",9),i._uU(31,"account_circle"),i.qZA(),i.TgZ(32,"h3",10),i._uU(33,"tentang"),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i._UZ(34,"mat-sidenav",13,7),i.TgZ(36,"mat-sidenav-content",14),i._UZ(37,"router-outlet"),i.qZA(),i.qZA(),i.BQk()}2&t&&(i.xp6(16),i.Q6J("position","start")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0),i.xp6(18),i.Q6J("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0))},directives:[a.Ye,u.lW,c.Hw,s.rH,h.TM,h.JX,l.Hk,l.Tg,l.Nh,f.X2,h.Rh,s.lC],styles:[""]}),t})();var p=n(3250),g=n(2935),y=n(8569),m=n(8318),v=n(9764),w=n(878),b=n(6238),T=n(2855),I=n(9996),E=n(2023),_=n(8720),S=n(3835),A=n(45),D=n(2346),N=n(1858),k=n(1062),x=n(4762),C=n(250),R=n(308),O=function(t,e){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function L(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var P,M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},q=q||{},F=M||self;function U(){}function V(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function G(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var j="closure_uid_"+(1e9*Math.random()>>>0),B=0;function Z(t,e,n){return t.call.apply(t.bind,arguments)}function K(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function J(t,e,n){return(J=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Z:K).apply(null,arguments)}function Q(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function z(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function H(){this.s=this.s,this.o=this.o}var W={};H.prototype.s=!1,H.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,j)&&t[j]||(t[j]=++B)}(this);delete W[t]}},H.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Y=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},X=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function $(t){return Array.prototype.concat.apply([],arguments)}function tt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function et(t){return/^[\s\xa0]*$/.test(t)}var nt,rt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function it(t,e){return-1!=t.indexOf(e)}function ot(t,e){return t<e?-1:t>e?1:0}t:{var st=F.navigator;if(st){var at=st.userAgent;if(at){nt=at;break t}}nt=""}function ut(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ct(t){var e={};for(var n in t)e[n]=t[n];return e}var ht="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function lt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ht.length;o++)n=ht[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ft(t){return ft[" "](t),t}ft[" "]=U;var dt,pt,gt=it(nt,"Opera"),yt=it(nt,"Trident")||it(nt,"MSIE"),mt=it(nt,"Edge"),vt=mt||yt,wt=it(nt,"Gecko")&&!(it(nt.toLowerCase(),"webkit")&&!it(nt,"Edge"))&&!(it(nt,"Trident")||it(nt,"MSIE"))&&!it(nt,"Edge"),bt=it(nt.toLowerCase(),"webkit")&&!it(nt,"Edge");function Tt(){var t=F.document;return t?t.documentMode:void 0}t:{var It="",Et=(pt=nt,wt?/rv:([^\);]+)(\)|;)/.exec(pt):mt?/Edge\/([\d\.]+)/.exec(pt):yt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(pt):bt?/WebKit\/(\S+)/.exec(pt):gt?/(?:Version)[ \/]?(\S+)/.exec(pt):void 0);if(Et&&(It=Et?Et[1]:""),yt){var _t=Tt();if(null!=_t&&_t>parseFloat(It)){dt=String(_t);break t}}dt=It}var St={};var At=F.document&&yt&&(Tt()||parseInt(dt,10))||void 0,Dt=function(){if(!F.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{F.addEventListener("test",U,e),F.removeEventListener("test",U,e)}catch(n){}return t}();function Nt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function kt(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(wt){t:{try{ft(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:xt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&kt.Z.h.call(this)}}Nt.prototype.h=function(){this.defaultPrevented=!0},z(kt,Nt);var xt={2:"touch",3:"pen",4:"mouse"};kt.prototype.h=function(){kt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ct="closure_listenable_"+(1e6*Math.random()|0),Rt=0;function Ot(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Rt,this.ca=this.fa=!1}function Lt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Pt(t){this.src=t,this.g={},this.h=0}function Mt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=Y(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Lt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function qt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Pt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=qt(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Ot(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Ft="closure_lm_"+(1e6*Math.random()|0),Ut={};function Vt(t,e,n,r,i){if(r&&r.once)return jt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[Ct]?t.N(e,n,G(r)?!!r.capture:!!r,i):Gt(t,e,n,!1,r,i)}function Gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=G(i)?!!i.capture:!!i,a=Qt(t);if(a||(t[Ft]=a=new Pt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Jt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Dt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Kt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function jt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)jt(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[Ct]?t.O(e,n,G(r)?!!r.capture:!!r,i):Gt(t,e,n,!0,r,i)}function Bt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Bt(t,e[o],n,r,i);else r=G(r)?!!r.capture:!!r,n=Ht(n),t&&t[Ct]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=qt(o=t.g[e],n,r,i))&&(Lt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Qt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=qt(e,n,r,i)),(n=-1<t?e[t]:null)&&Zt(n))}function Zt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Ct])Mt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Kt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Qt(e))?(Mt(n,t),0==n.h&&(n.src=null,e[Ft]=null)):Lt(t)}}}function Kt(t){return t in Ut?Ut[t]:Ut[t]="on"+t}function Jt(t,e){if(t.ca)t=!0;else{e=new kt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Zt(t),t=n.call(r,e)}return t}function Qt(t){return(t=t[Ft])instanceof Pt?t:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ht(t){return"function"==typeof t?t:(t[zt]||(t[zt]=function(e){return t.handleEvent(e)}),t[zt])}function Wt(){H.call(this),this.i=new Pt(this),this.P=this,this.I=null}function Yt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Nt(e,t);else if(e instanceof Nt)e.target=e.target||t;else{var i=e;lt(e=new Nt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Xt(s,r,!0,e)&&i}if(i=Xt(s=e.g=t,r,!0,e)&&i,i=Xt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Xt(s=e.g=n[o],r,!1,e)&&i}function Xt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Mt(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}z(Wt,H),Wt.prototype[Ct]=!0,Wt.prototype.removeEventListener=function(t,e,n,r){Bt(this,t,e,n,r)},Wt.prototype.M=function(){if(Wt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Lt(n[r]);delete e.g[t],e.h--}}this.I=null},Wt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Wt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var $t=F.JSON.stringify;function te(){var t=ue,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ee,ne=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=re.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),re=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new ie},function(t){return t.reset()}),ie=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function oe(t){F.setTimeout(function(){throw t},0)}function se(t,e){ee||function(){var t=F.Promise.resolve(void 0);ee=function(){t.then(ce)}}(),ae||(ee(),ae=!0),ue.add(t,e)}var ae=!1,ue=new ne;function ce(){for(var t;t=te();){try{t.h.call(t.g)}catch(n){oe(n)}var e=re;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ae=!1}function he(t,e){Wt.call(this),this.h=t||1,this.g=e||F,this.j=J(this.kb,this),this.l=Date.now()}function le(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function fe(t,e,n){if("function"==typeof t)n&&(t=J(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=J(t.handleEvent,t)}return 2147483647<Number(e)?-1:F.setTimeout(t,e||0)}function de(t){t.g=fe(function(){t.g=null,t.i&&(t.i=!1,de(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}z(he,Wt),(P=he.prototype).da=!1,P.S=null,P.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Yt(this,"tick"),this.da&&(le(this),this.start()))}},P.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},P.M=function(){he.Z.M.call(this),le(this),delete this.g};var pe=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:de(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(F.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(H);function ge(t){H.call(this),this.h=t,this.g={}}z(ge,H);var ye=[];function me(t,e,n,r){Array.isArray(n)||(n&&(ye[0]=n.toString()),n=ye);for(var i=0;i<n.length;i++){var o=Vt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ve(t){ut(t.g,function(t,e){this.g.hasOwnProperty(e)&&Zt(t)},t),t.g={}}function we(){this.g=!0}function be(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return $t(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ge.prototype.M=function(){ge.Z.M.call(this),ve(this)},ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},we.prototype.Aa=function(){this.g=!1},we.prototype.info=function(){};var Te={},Ie=null;function Ee(){return Ie=Ie||new Wt}function _e(t){Nt.call(this,Te.Ma,t)}function Se(t){var e=Ee();Yt(e,new _e(e,t))}function Ae(t,e){Nt.call(this,Te.STAT_EVENT,t),this.stat=e}function De(t){var e=Ee();Yt(e,new Ae(e,t))}function Ne(t,e){Nt.call(this,Te.Na,t),this.size=e}function ke(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return F.setTimeout(function(){t()},e)}Te.Ma="serverreachability",z(_e,Nt),Te.STAT_EVENT="statevent",z(Ae,Nt),Te.Na="timingevent",z(Ne,Nt);var xe={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ce={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Re(){}function Oe(){}Re.prototype.h=null;var Le,Pe={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Me(){Nt.call(this,"d")}function qe(){Nt.call(this,"c")}function Fe(){}function Ue(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ge(this),this.P=Ge,this.W=new he(t=vt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}z(Me,Nt),z(qe,Nt),z(Fe,Re),Fe.prototype.g=function(){return new XMLHttpRequest},Fe.prototype.i=function(){return{}},Le=new Fe;var Ge=45e3,je={},Be={};function Ze(t,e,n){t.K=1,t.v=pn(un(e)),t.s=n,t.U=!0,Ke(t,null)}function Ke(t,e){t.F=Date.now(),He(t),t.A=un(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Dn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ve,t.g=Nr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new pe(J(t.Ia,t,t.g),t.O)),me(t.V,t.g,"readystatechange",t.gb),e=t.H?ct(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Se(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Je(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Qe(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=ze(t,n))==Be){4==e&&(t.o=4,De(14),i=!1),be(t.j,t.m,null,"[Incomplete Response]");break}if(r==je){t.o=4,De(15),be(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}be(t.j,t.m,r,null),tn(t,r)}Je(t)&&r!=Be&&r!=je&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,De(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),br(e),e.L=!0,De(11))):(be(t.j,t.m,n,"[Invalid Chunked Response]"),$e(t),Xe(t))}function ze(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Be:(n=Number(e.substring(n,r)),isNaN(n)?je:(r+=1)+n>e.length?Be:(e=e.substr(r,n),t.C=r+n,e))}function He(t){t.Y=Date.now()+t.P,We(t,t.P)}function We(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ke(J(t.eb,t),e)}function Ye(t){t.B&&(F.clearTimeout(t.B),t.B=null)}function Xe(t){0==t.l.G||t.I||Er(t.l,t)}function $e(t){Ye(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,le(t.W),ve(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function tn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Ln(n.i,t)))if(n.I=t.N,!t.J&&Ln(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Ir(n),lr(n)}wr(n),De(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=ke(J(n.ab,n),6e3));if(1>=On(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Sr(n,11)}else if((t.J||n.g==t)&&Ir(n),!et(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(it(h,"spdy")||it(h,"quic")||it(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Pn(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,dn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Dr(r,r.H?r.la:null,r.W),d.J){Mn(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(Ye(p),He(p)),r.g=d}else vr(r);0<n.l.length&&pr(n)}else"stop"!=o[0]&&"close"!=o[0]||Sr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Sr(n,7):hr(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Se(4)}catch(o){}}function en(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(V(t)||"string"==typeof t)X(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(V(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(V(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function nn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof nn)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function rn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];on(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)on(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function on(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(P=Ue.prototype).setTimeout=function(t){this.P=t},P.gb=function(t){t=t.target;var e=this.L;e&&3==or(t)?e.l():this.Ia(t)},P.Ia=function(t){try{if(t==this.g)t:{var e=or(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||vt||this.g&&(this.h.h||this.g.ga()||sr(this.g)))){this.I||4!=e||7==n||Se(8==n||0>=r?3:2),Ye(this);var i=this.g.ba();this.N=i;e:if(Je(this)){var o=sr(this.g);t="";var s=o.length,a=4==or(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),Xe(this);var u="";break e}this.h.i=new F.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!et(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,De(12),$e(this),Xe(this);break t}be(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,tn(this,i)}this.U?(Qe(this,e,u),vt&&this.i&&3==e&&(me(this.V,this.W,"tick",this.fb),this.W.start())):(be(this.j,this.m,u,null),tn(this,u)),4==e&&$e(this),this.i&&!this.I&&(4==e?Er(this.l,this):(this.i=!1,He(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,De(12)):(this.o=0,De(13)),$e(this),Xe(this)}}}catch(e){}},P.fb=function(){if(this.g){var t=or(this.g),e=this.g.ga();this.C<e.length&&(Ye(this),Qe(this,t,e),this.i&&4!=t&&He(this))}},P.cancel=function(){this.I=!0,$e(this)},P.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Se(3),De(17)),$e(this),this.o=2,Xe(this)):We(this,this.Y-t)},(P=nn.prototype).R=function(){rn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},P.T=function(){return rn(this),this.g.concat()},P.get=function(t,e){return on(this.h,t)?this.h[t]:e},P.set=function(t,e){on(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},P.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var sn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function an(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof an){this.g=void 0!==e?e:t.g,cn(this,t.j),this.s=t.s,hn(this,t.i),ln(this,t.m),this.l=t.l,e=t.h;var n=new En;n.i=e.i,e.g&&(n.g=new nn(e.g),n.h=e.h),fn(this,n),this.o=t.o}else t&&(n=String(t).match(sn))?(this.g=!!e,cn(this,n[1]||"",!0),this.s=gn(n[2]||""),hn(this,n[3]||"",!0),ln(this,n[4]),this.l=gn(n[5]||"",!0),fn(this,n[6]||"",!0),this.o=gn(n[7]||"")):(this.g=!!e,this.h=new En(null,this.g))}function un(t){return new an(t)}function cn(t,e,n){t.j=n?gn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function hn(t,e,n){t.i=n?gn(e,!0):e}function ln(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function fn(t,e,n){e instanceof En?(t.h=e,function(t,e){e&&!t.j&&(_n(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Sn(this,e),Dn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=yn(e,Tn)),t.h=new En(e,t.g))}function dn(t,e,n){t.h.set(e,n)}function pn(t){return dn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function gn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function yn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,mn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function mn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}an.prototype.toString=function(){var t=[],e=this.j;e&&t.push(yn(e,vn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(yn(e,vn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(yn(n,"/"==n.charAt(0)?bn:wn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",yn(n,In)),t.join("")};var vn=/[#\/\?@]/g,wn=/[#\?:]/g,bn=/[#\?]/g,Tn=/[#\?@]/g,In=/#/g;function En(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function _n(t){t.g||(t.g=new nn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Sn(t,e){_n(t),e=Nn(t,e),on(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,on((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&rn(t)))}function An(t,e){return _n(t),e=Nn(t,e),on(t.g.h,e)}function Dn(t,e,n){Sn(t,e),0<n.length&&(t.i=null,t.g.set(Nn(t,e),tt(n)),t.h+=n.length)}function Nn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(P=En.prototype).add=function(t,e){_n(this),this.i=null,t=Nn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},P.forEach=function(t,e){_n(this),this.g.forEach(function(n,r){X(n,function(n){t.call(e,n,r,this)},this)},this)},P.T=function(){_n(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},P.R=function(t){_n(this);var e=[];if("string"==typeof t)An(this,t)&&(e=$(e,this.g.get(Nn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=$(e,t[n])}return e},P.set=function(t,e){return _n(this),this.i=null,An(this,t=Nn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},P.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},P.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var kn=function(){return function(t,e){this.h=t,this.g=e}}();function xn(t){this.l=t||Cn,t=F.PerformanceNavigationTiming?0<(t=F.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(F.g&&F.g.Ea&&F.g.Ea()&&F.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Cn=10;function Rn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function On(t){return t.h?1:t.g?t.g.size:0}function Ln(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Pn(t,e){t.g?t.g.add(e):t.h=e}function Mn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function qn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=L(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return tt(t.i)}function Fn(){}function Un(){this.g=new Fn}function Vn(t,e,n){var r=n||"";try{en(t,function(t,n){var i=t;G(t)&&(i=$t(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Hd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Hd}}function Gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function jn(t){this.l=t.$b||null,this.j=t.ib||!1}function Bn(t,e){Wt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Zn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}xn.prototype.cancel=function(){var t,e;if(this.i=qn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=L(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Fn.prototype.stringify=function(t){return F.JSON.stringify(t,void 0)},Fn.prototype.parse=function(t){return F.JSON.parse(t,void 0)},z(jn,Re),jn.prototype.g=function(){return new Bn(this.l,this.j)},jn.prototype.i=function(t){return function(){return t}}({}),z(Bn,Wt);var Zn=0;function Kn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Jn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Qn(t)}function Qn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(P=Bn.prototype).open=function(t,e){if(this.readyState!=Zn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Qn(this)},P.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||F).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},P.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Jn(this)),this.readyState=Zn},P.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Qn(this)),this.g&&(this.readyState=3,Qn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==F.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Kn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},P.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Jn(this):Qn(this),3==this.readyState&&Kn(this)}},P.Ua=function(t){this.g&&(this.response=this.responseText=t,Jn(this))},P.Ta=function(t){this.g&&(this.response=t,Jn(this))},P.ha=function(){this.g&&Jn(this)},P.setRequestHeader=function(t,e){this.v.append(t,e)},P.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},P.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var zn=F.JSON.parse;function Hn(t){Wt.call(this),this.headers=new nn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Wn,this.K=this.L=!1}z(Hn,Wt);var Wn="",Yn=/^https?$/i,Xn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function tr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,er(t),rr(t)}function er(t){t.D||(t.D=!0,Yt(t,"complete"),Yt(t,"error"))}function nr(t){if(t.h&&void 0!==q&&(!t.C[1]||4!=or(t)||2!=t.ba()))if(t.v&&4==or(t))fe(t.Fa,0,t);else if(Yt(t,"readystatechange"),4==or(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(sn)[1]||null;if(!o&&F.self&&F.self.location){var s=F.self.location.protocol;o=s.substr(0,s.length-1)}i=!Yn.test(o?o.toLowerCase():"")}e=i}if(e)Yt(t,"complete"),Yt(t,"success");else{t.m=6;try{var a=2<or(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",er(t)}}finally{rr(t)}}}function rr(t,e){if(t.g){ir(t);var n=t.g,r=t.C[0]?U:null;t.g=null,t.C=null,e||Yt(t,"ready");try{n.onreadystatechange=r}catch(Hd){}}}function ir(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(F.clearTimeout(t.A),t.A=null)}function or(t){return t.g?t.g.readyState:0}function sr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Wn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ar(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return ut(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):dn(t,e,n))}function ur(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function cr(t){this.za=0,this.l=[],this.h=new we,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ur("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ur("baseRetryDelayMs",5e3,t),this.$a=ur("retryDelaySeedMs",1e4,t),this.Ya=ur("forwardChannelMaxRetries",2,t),this.ra=ur("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new xn(t&&t.concurrentRequestLimit),this.Ca=new Un,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function hr(t){if(fr(t),3==t.G){var e=t.V++,n=un(t.F);dn(n,"SID",t.J),dn(n,"RID",e),dn(n,"TYPE","terminate"),yr(t,n),(e=new Ue(t,t.h,e,void 0)).K=2,e.v=pn(un(n)),n=!1,F.navigator&&F.navigator.sendBeacon&&(n=F.navigator.sendBeacon(e.v.toString(),"")),!n&&F.Image&&((new Image).src=e.v,n=!0),n||(e.g=Nr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),He(e)}Ar(t)}function lr(t){t.g&&(br(t),t.g.cancel(),t.g=null)}function fr(t){lr(t),t.u&&(F.clearTimeout(t.u),t.u=null),Ir(t),t.i.cancel(),t.m&&("number"==typeof t.m&&F.clearTimeout(t.m),t.m=null)}function dr(t,e){t.l.push(new kn(t.Za++,e)),3==t.G&&pr(t)}function pr(t){Rn(t.i)||t.m||(t.m=!0,se(t.Ha,t),t.C=0)}function gr(t,e){var n;n=e?e.m:t.V++;var r=un(t.F);dn(r,"SID",t.J),dn(r,"RID",n),dn(r,"AID",t.U),yr(t,r),t.o&&t.s&&ar(r,t.o,t.s),n=new Ue(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=mr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Pn(t.i,n),Ze(n,r,e)}function yr(t,e){t.j&&en({},function(t,n){dn(e,n,t)})}function mr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?J(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{Vn(h,s,"req"+c+"_")}catch(ai){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function vr(t){t.g||t.u||(t.Y=1,se(t.Ga,t),t.A=0)}function wr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=ke(J(t.Ga,t),_r(t,t.A)),t.A++,0))}function br(t){null!=t.B&&(F.clearTimeout(t.B),t.B=null)}function Tr(t){t.g=new Ue(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=un(t.oa);dn(e,"RID","rpc"),dn(e,"SID",t.J),dn(e,"CI",t.N?"0":"1"),dn(e,"AID",t.U),yr(t,e),dn(e,"TYPE","xmlhttp"),t.o&&t.s&&ar(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=pn(un(e)),n.s=null,n.U=!0,Ke(n,t)}function Ir(t){null!=t.v&&(F.clearTimeout(t.v),t.v=null)}function Er(t,e){var n=null;if(t.g==e){Ir(t),br(t),t.g=null;var r=2}else{if(!Ln(t.i,e))return;n=e.D,Mn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Yt(r=Ee(),new Ne(r,n,e,i)),pr(t)}else vr(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(On(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=ke(J(t.Ha,t,e),_r(t,t.C)),t.C++,0)))}(t,e)||2==r&&wr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Sr(t,5);break;case 4:Sr(t,10);break;case 3:Sr(t,6);break;default:Sr(t,2)}}function _r(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Sr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=J(t.jb,t);n||(n=new an("//www.google.com/images/cleardot.gif"),F.location&&"http"==F.location.protocol||cn(n,"https"),pn(n)),function(t,e){var n=new we;if(F.Image){var r=new Image;r.onload=Q(Gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Q(Gn,n,r,"TestLoadImage: error",!1,e),r.onabort=Q(Gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Q(Gn,n,r,"TestLoadImage: timeout",!1,e),F.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else De(2);t.G=0,t.j&&t.j.va(e),Ar(t),fr(t)}function Ar(t){t.G=0,t.I=-1,t.j&&(0==qn(t.i).length&&0==t.l.length||(t.i.i.length=0,tt(t.l),t.l.length=0),t.j.ua())}function Dr(t,e,n){var r=function(t){return t instanceof an?un(t):new an(t,void 0)}(n);if(""!=r.i)e&&hn(r,e+"."+r.i),ln(r,r.m);else{var i=F.location;r=function(t,e,n,r){var i=new an(null,void 0);return t&&cn(i,t),e&&hn(i,e),n&&ln(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&ut(t.aa,function(t,e){dn(r,e,t)}),n=t.sa,(e=t.D)&&n&&dn(r,e,n),dn(r,"VER",t.ma),yr(t,r),r}function Nr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Hn(n&&t.Ba&&!t.qa?new jn({ib:!0}):t.qa)).L=t.H,e}function kr(){}function xr(){if(yt&&!(10<=Number(At)))throw Error("Environmental error: no available transport.")}function Cr(t,e){Wt.call(this),this.g=new cr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!et(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!et(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Lr(this)}function Rr(t){Me.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Or(){qe.call(this),this.status=1}function Lr(t){this.g=t}(P=Hn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Le.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Le),this.g.onreadystatechange=J(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void tr(this,o)}t=n||"";var i=new nn(this.headers);r&&en(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=$n,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=F.FormData&&t instanceof F.FormData,!(0<=Y(Xn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ir(this),0<this.B&&((this.K=function(t){return yt&&function(){return t=St,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=rt(String(dt)).split("."),n=rt("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=ot(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||ot(0==o[2].length,0==s[2].length)||ot(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=J(this.pa,this)):this.A=fe(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){tr(this,o)}},P.pa=function(){void 0!==q&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Yt(this,"timeout"),this.abort(8))},P.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Yt(this,"complete"),Yt(this,"abort"),rr(this))},P.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),rr(this,!0)),Hn.Z.M.call(this)},P.Fa=function(){this.s||(this.F||this.v||this.l?nr(this):this.cb())},P.cb=function(){nr(this)},P.ba=function(){try{return 2<or(this)?this.g.status:-1}catch(pt){return-1}},P.ga=function(){try{return this.g?this.g.responseText:""}catch(pt){return""}},P.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),zn(e)}},P.Da=function(){return this.m},P.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(P=cr.prototype).ma=8,P.G=1,P.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},P.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ue(this,this.h,t,void 0),n=this.s;if(this.P&&(n?lt(n=ct(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=mr(this,e,r),dn(i=un(this.F),"RID",t),dn(i,"CVER",22),this.D&&dn(i,"X-HTTP-Session-Id",this.D),yr(this,i),this.o&&n&&ar(i,this.o,n),Pn(this.i,e),this.Ra&&dn(i,"TYPE","init"),this.ja?(dn(i,"$req",r),dn(i,"SID","null"),e.$=!0,Ze(e,i,null)):Ze(e,i,r),this.G=2}}else 3==this.G&&(t?gr(this,t):0==this.l.length||Rn(this.i)||gr(this))},P.Ga=function(){if(this.u=null,Tr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=ke(J(this.bb,this),t)}},P.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,De(10),lr(this),Tr(this))},P.ab=function(){null!=this.v&&(this.v=null,lr(this),wr(this),De(19))},P.jb=function(t){t?(this.h.info("Successfully pinged google.com"),De(2)):(this.h.info("Failed to ping google.com"),De(1))},(P=kr.prototype).xa=function(){},P.wa=function(){},P.va=function(){},P.ua=function(){},P.Oa=function(){},xr.prototype.g=function(t,e){return new Cr(t,e)},z(Cr,Wt),Cr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),se(J(t.hb,t,e))),De(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Dr(t,null,t.W),pr(t)},Cr.prototype.close=function(){hr(this.g)},Cr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,dr(this.g,e)}else this.v?((e={}).__data__=$t(t),dr(this.g,e)):dr(this.g,t)},Cr.prototype.M=function(){this.g.j=null,delete this.j,hr(this.g),delete this.g,Cr.Z.M.call(this)},z(Rr,Me),z(Or,qe),z(Lr,kr),Lr.prototype.xa=function(){Yt(this.g,"a")},Lr.prototype.wa=function(t){Yt(this.g,new Rr(t))},Lr.prototype.va=function(t){Yt(this.g,new Or(t))},Lr.prototype.ua=function(){Yt(this.g,"b")},xr.prototype.createWebChannel=xr.prototype.g,Cr.prototype.send=Cr.prototype.u,Cr.prototype.open=Cr.prototype.m,Cr.prototype.close=Cr.prototype.close,xe.NO_ERROR=0,xe.TIMEOUT=8,xe.HTTP_ERROR=6,Ce.COMPLETE="complete",Oe.EventType=Pe,Pe.OPEN="a",Pe.CLOSE="b",Pe.ERROR="c",Pe.MESSAGE="d",Wt.prototype.listen=Wt.prototype.N,Hn.prototype.listenOnce=Hn.prototype.O,Hn.prototype.getLastError=Hn.prototype.La,Hn.prototype.getLastErrorCode=Hn.prototype.Da,Hn.prototype.getStatus=Hn.prototype.ba,Hn.prototype.getResponseJson=Hn.prototype.Qa,Hn.prototype.getResponseText=Hn.prototype.ga,Hn.prototype.send=Hn.prototype.ea;var Pr=xe,Mr=Ce,qr=Te,Fr=jn,Ur=Oe,Vr=Hn,Gr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Gr.o=-1;var jr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Br=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,x.ZT)(e,t),e}(Error),Zr=new R.Yd("@firebase/firestore");function Kr(){return Zr.logLevel}function Jr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Zr.logLevel<=R.in.DEBUG){var r=e.map(Hr);Zr.debug.apply(Zr,(0,x.ev)(["Firestore (8.8.1): "+t],r))}}function Qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Zr.logLevel<=R.in.ERROR){var r=e.map(Hr);Zr.error.apply(Zr,(0,x.ev)(["Firestore (8.8.1): "+t],r))}}function zr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Zr.logLevel<=R.in.WARN){var r=e.map(Hr);Zr.warn.apply(Zr,(0,x.ev)(["Firestore (8.8.1): "+t],r))}}function Hr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Hd){return t}}function Wr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.1) INTERNAL ASSERTION FAILED: "+t;throw Qr(e),new Error(e)}function Yr(t,e){t||Wr()}function Xr(t,e){return t}function $r(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var ti=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=$r(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function ei(t,e){return t<e?-1:t>e?1:0}function ni(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function ri(t){return t+"\0"}var ii=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Br(jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Br(jr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Br(jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Br(jr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ei(this.nanoseconds,t.nanoseconds):ei(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),oi=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ii(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function si(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ai(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ui(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ci=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Wr(),void 0===n?n=t.length-e:n>t.length-e&&Wr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Br(jr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ci),li=/^[_a-zA-Z][_a-zA-Z0-9]*$/,fi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return li.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Br(jr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Br(jr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Br(jr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Br(jr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ci),di=function(){function t(t){this.fields=t,t.sort(fi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return ni(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),pi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return ei(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();pi.EMPTY_BYTE_STRING=new pi("");var gi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yi(t){if(Yr(!!t),"string"==typeof t){var e=0,n=gi.exec(t);if(Yr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:mi(t.seconds),nanos:mi(t.nanos)}}function mi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function vi(t){return"string"==typeof t?pi.fromBase64String(t):pi.fromUint8Array(t)}function wi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bi(t){var e=t.mapValue.fields.__previous_value__;return wi(e)?bi(e):e}function Ti(t){var e=yi(t.mapValue.fields.__local_write_time__.timestampValue);return new ii(e.seconds,e.nanos)}function Ii(t){return null==t}function Ei(t){return 0===t&&1/t==-1/0}function _i(t){return"number"==typeof t&&Number.isInteger(t)&&!Ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Si=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(hi.fromString(e))},t.fromName=function(e){return new t(hi.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===hi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return hi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new hi(e.slice()))},t}();function Ai(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wi(t)?4:10:Wr()}function Di(t,e){var n=Ai(t);if(n!==Ai(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ti(t).isEqual(Ti(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=yi(t.timestampValue),r=yi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return vi(t.bytesValue).isEqual(vi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return mi(t.geoPointValue.latitude)===mi(e.geoPointValue.latitude)&&mi(t.geoPointValue.longitude)===mi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return mi(t.integerValue)===mi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=mi(t.doubleValue),r=mi(e.doubleValue);return n===r?Ei(n)===Ei(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ni(t.arrayValue.values||[],e.arrayValue.values||[],Di);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(si(n)!==si(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Di(n[i],r[i])))return!1;return!0}(t,e);default:return Wr()}}function Ni(t,e){return void 0!==(t.values||[]).find(function(t){return Di(t,e)})}function ki(t,e){var n=Ai(t),r=Ai(e);if(n!==r)return ei(n,r);switch(n){case 0:return 0;case 1:return ei(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=mi(t.integerValue||t.doubleValue),r=mi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return xi(t.timestampValue,e.timestampValue);case 4:return xi(Ti(t),Ti(e));case 5:return ei(t.stringValue,e.stringValue);case 6:return function(t,e){var n=vi(t),r=vi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ei(n[i],r[i]);if(0!==o)return o}return ei(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ei(mi(t.latitude),mi(e.latitude));return 0!==n?n:ei(mi(t.longitude),mi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ki(n[i],r[i]);if(o)return o}return ei(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=ei(r[s],o[s]);if(0!==a)return a;var u=ki(n[r[s]],i[o[s]]);if(0!==u)return u}return ei(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Wr()}}function xi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ei(t,e);var n=yi(t),r=yi(e),i=ei(n.seconds,r.seconds);return 0!==i?i:ei(n.nanos,r.nanos)}function Ci(t){return Ri(t)}function Ri(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=yi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?vi(t.bytesValue).toBase64():"referenceValue"in t?Si.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ri(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ri(t.fields[o])}return e+"}"}(t.mapValue):Wr();var e}function Oi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Li(t){return!!t&&"integerValue"in t}function Pi(t){return!!t&&"arrayValue"in t}function Mi(t){return!!t&&"nullValue"in t}function qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Fi(t){return!!t&&"mapValue"in t}function Ui(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return ai(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Ui(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ui(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Vi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Fi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ui(e)},t.prototype.setAll=function(t){var e=this,n=fi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Ui(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Di(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Fi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){ai(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Ui(this.value))},t}();function Gi(t){var e=[];return ai(t.fields,function(t,n){var r=new fi([t]);if(Fi(n)){var i=Gi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new di(e)}var ji=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,oi.min(),Vi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Vi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Vi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Vi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Vi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Bi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Zi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Bi(t,e,n,r,i,o,s)}function Ki(t){var e=Xr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Ci(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Ii(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=io(e.startAt)),e.endAt&&(n+="|ub:",n+=io(e.endAt)),e.h=n}return e.h}function Ji(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!so(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Di(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!uo(t.startAt,e.startAt)&&uo(t.endAt,e.endAt)}function Qi(t){return Si.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var zi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,x.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Hi(t,n,r):"array-contains"===n?new $i(t,r):"in"===n?new to(t,r):"not-in"===n?new eo(t,r):"array-contains-any"===n?new no(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Wi(t,n):new Yi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ki(e,this.value)):null!==e&&Ai(this.value)===Ai(e)&&this.m(ki(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Wr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Hi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Si.fromName(r.referenceValue),i}return(0,x.ZT)(e,t),e.prototype.matches=function(t){var e=Si.comparator(t.key,this.key);return this.m(e)},e}(zi),Wi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Xi(0,n),r}return(0,x.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(zi),Yi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Xi(0,n),r}return(0,x.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(zi);function Xi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Si.fromName(t.referenceValue)})}var $i=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,x.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Pi(e)&&Ni(e.arrayValue,this.value)},e}(zi),to=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,x.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Ni(this.value.arrayValue,e)},e}(zi),eo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,x.ZT)(e,t),e.prototype.matches=function(t){if(Ni(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ni(this.value.arrayValue,e)},e}(zi),no=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,x.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Pi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ni(e.value.arrayValue,t)})},e}(zi),ro=function(t,e){this.position=t,this.before=e};function io(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Ci(t)}).join(",")}var oo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function so(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ao(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Si.comparator(Si.fromName(s.referenceValue),n.key):ki(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function uo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Di(t.position[n],e.position[n]))return!1;return!0}var co=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function ho(t,e,n,r,i,o,s,a){return new co(t,e,n,r,i,o,s,a)}function lo(t){return new co(t)}function fo(t){return!Ii(t.limit)&&"F"===t.limitType}function po(t){return!Ii(t.limit)&&"L"===t.limitType}function go(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function yo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function mo(t){return null!==t.collectionGroup}function vo(t){var e=Xr(t);if(null===e.p){e.p=[];var n=yo(e),r=go(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new oo(n)),e.p.push(new oo(fi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new oo(fi.keyField(),u))}}}return e.p}function wo(t){var e=Xr(t);if(!e.T)if("F"===e.limitType)e.T=Zi(e.path,e.collectionGroup,vo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=vo(e);r<i.length;r++){var o=i[r];n.push(new oo(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new ro(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ro(e.startAt.position,!e.startAt.before):null;e.T=Zi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function bo(t,e,n){return new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function To(t,e){return Ji(wo(t),wo(e))&&t.limitType===e.limitType}function Io(t){return Ki(wo(t))+"|lt:"+t.limitType}function Eo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Ci(e.value);var e}).join(", ")+"]"),Ii(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+io(t.startAt)),t.endAt&&(e+=", endAt: "+io(t.endAt)),"Target("+e+")"}(wo(t))+"; limitType="+t.limitType+")"}function _o(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Si.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ao(t.startAt,vo(t),e)||t.endAt&&ao(t.endAt,vo(t),e))}(t,e)}function So(t){return function(e,n){for(var r=!1,i=0,o=vo(t);i<o.length;i++){var s=o[i],a=Ao(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Ao(t,e,n){var r=t.field.isKeyField()?Si.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ki(r,i):Wr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Wr()}}function Do(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ei(e)?"-0":e}}function No(t){return{integerValue:""+t}}function ko(t,e){return _i(e)?No(e):Do(t,e)}var xo=function(){this._=void 0};function Co(t,e,n){return t instanceof Lo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Po?Mo(t,e):t instanceof qo?Fo(t,e):function(t,e){var n=Oo(t,e),r=Vo(n)+Vo(t.A);return Li(n)&&Li(t.A)?No(r):Do(t.R,r)}(t,e)}function Ro(t,e,n){return t instanceof Po?Mo(t,e):t instanceof qo?Fo(t,e):n}function Oo(t,e){return t instanceof Uo?Li(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Lo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e}(xo),Po=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,x.ZT)(e,t),e}(xo);function Mo(t,e){for(var n=Go(e),r=function(t){n.some(function(e){return Di(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var qo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,x.ZT)(e,t),e}(xo);function Fo(t,e){for(var n=Go(e),r=function(t){n=n.filter(function(e){return!Di(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Uo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,x.ZT)(e,t),e}(xo);function Vo(t){return mi(t.integerValue||t.doubleValue)}function Go(t){return Pi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var jo=function(t,e){this.field=t,this.transform=e},Bo=function(t,e){this.version=t,this.transformResults=e},Zo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ko(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Jo=function(){};function Qo(t,e,n){t instanceof Xo?function(t,e,n){var r=t.value.clone(),i=es(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof $o?function(t,e,n){if(Ko(t.precondition,e)){var r=es(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ts(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function zo(t,e,n){t instanceof Xo?function(t,e,n){if(Ko(t.precondition,e)){var r=t.value.clone(),i=ns(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Yo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof $o?function(t,e,n){if(Ko(t.precondition,e)){var r=ns(t.fieldTransforms,n,e),i=e.data;i.setAll(ts(t)),i.setAll(r),e.convertToFoundDocument(Yo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Ko(t.precondition,e)&&e.convertToNoDocument(oi.min())}(t,e)}function Ho(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Oo(o.transform,s||null);null!=a&&(null==n&&(n=Vi.empty()),n.set(o.field,a))}return n||null}function Wo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ni(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Po&&e instanceof Po||t instanceof qo&&e instanceof qo?ni(t.elements,e.elements,Di):t instanceof Uo&&e instanceof Uo?Di(t.A,e.A):t instanceof Lo&&e instanceof Lo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Yo(t){return t.isFoundDocument()?t.version:oi.min()}var Xo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,x.ZT)(e,t),e}(Jo),$o=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,x.ZT)(e,t),e}(Jo);function ts(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function es(t,e,n){var r=new Map;Yr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Ro(s,a,n[i]))}return r}function ns(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Co(a,u,e))}return r}var rs,is,os=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,x.ZT)(e,t),e}(Jo),ss=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,x.ZT)(e,t),e}(Jo),as=function(t){this.count=t};function us(t){switch(t){case jr.OK:return Wr();case jr.CANCELLED:case jr.UNKNOWN:case jr.DEADLINE_EXCEEDED:case jr.RESOURCE_EXHAUSTED:case jr.INTERNAL:case jr.UNAVAILABLE:case jr.UNAUTHENTICATED:return!1;case jr.INVALID_ARGUMENT:case jr.NOT_FOUND:case jr.ALREADY_EXISTS:case jr.PERMISSION_DENIED:case jr.FAILED_PRECONDITION:case jr.ABORTED:case jr.OUT_OF_RANGE:case jr.UNIMPLEMENTED:case jr.DATA_LOSS:return!0;default:return Wr()}}function cs(t){if(void 0===t)return Qr("GRPC error has no .code"),jr.UNKNOWN;switch(t){case rs.OK:return jr.OK;case rs.CANCELLED:return jr.CANCELLED;case rs.UNKNOWN:return jr.UNKNOWN;case rs.DEADLINE_EXCEEDED:return jr.DEADLINE_EXCEEDED;case rs.RESOURCE_EXHAUSTED:return jr.RESOURCE_EXHAUSTED;case rs.INTERNAL:return jr.INTERNAL;case rs.UNAVAILABLE:return jr.UNAVAILABLE;case rs.UNAUTHENTICATED:return jr.UNAUTHENTICATED;case rs.INVALID_ARGUMENT:return jr.INVALID_ARGUMENT;case rs.NOT_FOUND:return jr.NOT_FOUND;case rs.ALREADY_EXISTS:return jr.ALREADY_EXISTS;case rs.PERMISSION_DENIED:return jr.PERMISSION_DENIED;case rs.FAILED_PRECONDITION:return jr.FAILED_PRECONDITION;case rs.ABORTED:return jr.ABORTED;case rs.OUT_OF_RANGE:return jr.OUT_OF_RANGE;case rs.UNIMPLEMENTED:return jr.UNIMPLEMENTED;case rs.DATA_LOSS:return jr.DATA_LOSS;default:return Wr()}}(is=rs||(rs={}))[is.OK=0]="OK",is[is.CANCELLED=1]="CANCELLED",is[is.UNKNOWN=2]="UNKNOWN",is[is.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",is[is.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",is[is.NOT_FOUND=5]="NOT_FOUND",is[is.ALREADY_EXISTS=6]="ALREADY_EXISTS",is[is.PERMISSION_DENIED=7]="PERMISSION_DENIED",is[is.UNAUTHENTICATED=16]="UNAUTHENTICATED",is[is.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",is[is.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",is[is.ABORTED=10]="ABORTED",is[is.OUT_OF_RANGE=11]="OUT_OF_RANGE",is[is.UNIMPLEMENTED=12]="UNIMPLEMENTED",is[is.INTERNAL=13]="INTERNAL",is[is.UNAVAILABLE=14]="UNAVAILABLE",is[is.DATA_LOSS=15]="DATA_LOSS";var hs=function(){function t(t,e){this.comparator=t,this.root=e||fs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,fs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ls(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ls(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ls(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ls(this.root,t,this.comparator,!0)},t}(),ls=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),fs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Wr();if(this.right.isRed())throw Wr();var t=this.left.check();if(t!==this.right.check())throw Wr();return t+(this.isRed()?0:1)},t}();fs.EMPTY=null,fs.RED=!0,fs.BLACK=!1,fs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new fs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ds=function(){function t(t){this.comparator=t,this.data=new hs(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ps(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ps(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ps=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),gs=new hs(Si.comparator);function ys(){return gs}var ms=new hs(Si.comparator);function vs(){return ms}var ws=new hs(Si.comparator);function bs(){return ws}var Ts=new ds(Si.comparator);function Is(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ts,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Es=new ds(ei);function _s(){return Es}var Ss=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,As.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(oi.min(),r,_s(),ys(),Is())},t}(),As=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(pi.EMPTY_BYTE_STRING,n,Is(),Is(),Is())},t}(),Ds=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Ns=function(t,e){this.targetId=t,this.V=e},ks=function(t,e,n,r){void 0===n&&(n=pi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},xs=function(){function t(){this.S=0,this.D=Os(),this.C=pi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Is(),e=Is(),n=Is();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Wr()}}),new As(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Os()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Cs=function(){function t(t){this.W=t,this.G=new Map,this.H=ys(),this.J=Rs(),this.Y=new ds(ei)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Wr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Qi(i))if(0===n){var o=new Si(i.path);this.tt(e,o,ji.newNoDocument(o,oi.min()))}else Yr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Qi(o.target)){var s=new Si(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,ji.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Is();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ss(t,n,this.Y,this.H,r);return this.H=ys(),this.J=Rs(),this.Y=new ds(ei),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new xs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ds(ei),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Jr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new xs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Rs(){return new hs(Si.comparator)}function Os(){return new hs(Si.comparator)}var Ls={asc:"ASCENDING",desc:"DESCENDING"},Ps={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ms=function(t,e){this.databaseId=t,this.I=e};function qs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fs(t,e){return t.I?e.toBase64():e.toUint8Array()}function Us(t,e){return qs(t,e.toTimestamp())}function Vs(t){return Yr(!!t),oi.fromTimestamp(function(t){var e=yi(t);return new ii(e.seconds,e.nanos)}(t))}function Gs(t,e){return function(t){return new hi(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function js(t){var e=hi.fromString(t);return Yr(fa(e)),e}function Bs(t,e){return Gs(t.databaseId,e.path)}function Zs(t,e){var n=js(e);if(n.get(1)!==t.databaseId.projectId)throw new Br(jr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Br(jr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Si(zs(n))}function Ks(t,e){return Gs(t.databaseId,e)}function Js(t){var e=js(t);return 4===e.length?hi.emptyPath():zs(e)}function Qs(t){return new hi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function zs(t){return Yr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Hs(t,e,n){return{name:Bs(t,e),fields:n.value.mapValue.fields}}function Ws(t,e,n){var r=Zs(t,e.name),i=Vs(e.updateTime),o=new Vi({mapValue:{fields:e.fields}}),s=ji.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ys(t,e){var n;if(e instanceof Xo)n={update:Hs(t,e.key,e.value)};else if(e instanceof os)n={delete:Bs(t,e.key)};else if(e instanceof $o)n={update:Hs(t,e.key,e.data),updateMask:la(e.fieldMask)};else{if(!(e instanceof ss))return Wr();n={verify:Bs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Lo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Po)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof qo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Uo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Wr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Us(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Wr()}(t,e.precondition)),n}function Xs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Zo.updateTime(Vs(t.updateTime)):void 0!==t.exists?Zo.exists(t.exists):Zo.none()}(e.currentDocument):Zo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Yr("REQUEST_TIME"===e.setToServerValue),n=new Lo):"appendMissingElements"in e?n=new Po(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new qo(e.removeAllFromArray.values||[]):"increment"in e?n=new Uo(t,e.increment):Wr();var r=fi.fromServerFormat(e.fieldPath);return new jo(r,n)}(t,e)}):[];if(e.update){var i=Zs(t,e.update.name),o=new Vi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new di((t.fieldPaths||[]).map(function(t){return fi.fromServerFormat(t)}))}(e.updateMask);return new $o(i,o,s,n,r)}return new Xo(i,o,n,r)}if(e.delete){var a=Zs(t,e.delete);return new os(a,n)}if(e.verify){var u=Zs(t,e.verify);return new ss(u,n)}return Wr()}function $s(t,e){return{documents:[Ks(t,e.path)]}}function ta(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ks(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ks(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(qi(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NAN"}};if(Mi(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(qi(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NOT_NAN"}};if(Mi(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aa(t.field),op:sa(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:aa(t.field),direction:oa(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Ii(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=ra(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ra(e.endAt)),n}function ea(t){var e=Js(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Yr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=na(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new oo(ua(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Ii(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ia(n.startAt));var h=null;return n.endAt&&(h=ia(n.endAt)),ho(e,i,a,s,u,"F",c,h)}function na(t){return t?void 0!==t.unaryFilter?[ha(t)]:void 0!==t.fieldFilter?[ca(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return na(t)}).reduce(function(t,e){return t.concat(e)}):Wr():[]}function ra(t){return{before:t.before,values:t.position}}function ia(t){return new ro(t.values||[],!!t.before)}function oa(t){return Ls[t]}function sa(t){return Ps[t]}function aa(t){return{fieldPath:t.canonicalString()}}function ua(t){return fi.fromServerFormat(t.fieldPath)}function ca(t){return zi.create(ua(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Wr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ha(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ua(t.unaryFilter.field);return zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ua(t.unaryFilter.field);return zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ua(t.unaryFilter.field);return zi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ua(t.unaryFilter.field);return zi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Wr()}}function la(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function fa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function da(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ga(e)),e=pa(t.get(n),e);return ga(e)}function pa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ga(t){return t+"\x01\x01"}function ya(t){var e=t.length;if(Yr(e>=2),2===e)return Yr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),hi.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Wr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Wr()}o=s+2}return new hi(r)}var ma=function(t,e){this.seconds=t,this.nanoseconds=e},va=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};va.store="owner",va.key="owner";var wa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};wa.store="mutationQueues",wa.keyPath="userId";var ba=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ba.store="mutations",ba.keyPath="batchId",ba.userMutationsIndex="userMutationsIndex",ba.userMutationsKeyPath=["userId","batchId"];var Ta=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,da(e)]},t.key=function(t,e,n){return[t,da(e),n]},t}();Ta.store="documentMutations",Ta.PLACEHOLDER=new Ta;var Ia=function(t,e){this.path=t,this.readTime=e},Ea=function(t,e){this.path=t,this.version=e},_a=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};_a.store="remoteDocuments",_a.readTimeIndex="readTimeIndex",_a.readTimeIndexPath="readTime",_a.collectionReadTimeIndex="collectionReadTimeIndex",_a.collectionReadTimeIndexPath=["parentPath","readTime"];var Sa=function(t){this.byteSize=t};Sa.store="remoteDocumentGlobal",Sa.key="remoteDocumentGlobalKey";var Aa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Aa.store="targets",Aa.keyPath="targetId",Aa.queryTargetsIndexName="queryTargetsIndex",Aa.queryTargetsKeyPath=["canonicalId","targetId"];var Da=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Da.store="targetDocuments",Da.keyPath=["targetId","path"],Da.documentTargetsIndex="documentTargetsIndex",Da.documentTargetsKeyPath=["path","targetId"];var Na=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Na.key="targetGlobalKey",Na.store="targetGlobal";var ka=function(t,e){this.collectionId=t,this.parent=e};ka.store="collectionParents",ka.keyPath=["collectionId","parent"];var xa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};xa.store="clientMetadata",xa.keyPath="clientId";var Ca=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Ca.store="bundles",Ca.keyPath="bundleId";var Ra=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ra.store="namedQueries",Ra.keyPath="name";var Oa=(0,x.ev)((0,x.ev)([],(0,x.ev)((0,x.ev)([],(0,x.ev)((0,x.ev)([],(0,x.ev)((0,x.ev)([],[wa.store,ba.store,Ta.store,_a.store,Aa.store,va.store,Na.store,Da.store]),[xa.store])),[Sa.store])),[ka.store])),[Ca.store,Ra.store]),La="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Pa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Ma=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},qa=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Fa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ma,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ga(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ja(e.target.error);n.ft.reject(new Ga(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ga(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Jr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ba(e)},t}(),Ua=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,C.z$)())&&Qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Jr("SimpleDb","Removing database:",t),Za(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,C.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n=this;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Jr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ga(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Br(jr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ga(t,n))},i.onupgradeneeded=function(t){Jr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Jr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,x.Jh)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return(0,x.Jh)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Fa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),qa.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Jr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Va=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Za(this.Pt.delete())},t}(),Ga=function(t){function e(e,n){var r=this;return(r=t.call(this,jr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,x.ZT)(e,t),e}(Br);function ja(t){return"IndexedDbTransactionError"===t.name}var Ba=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Jr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Jr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Za(n)},t.prototype.add=function(t){return Jr("SimpleDb","ADD",this.store.name,t,t),Za(this.store.add(t))},t.prototype.get=function(t){var e=this;return Za(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Jr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Jr("SimpleDb","DELETE",this.store.name,t),Za(this.store.delete(t))},t.prototype.count=function(){return Jr("SimpleDb","COUNT",this.store.name),Za(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Jr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new qa(function(n,r){e.onerror=function(t){var e=Ja(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new qa(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Va(i),s=e(i.primaryKey,i.value,o);if(s instanceof qa){var a=s.catch(function(t){return o.done(),qa.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return qa.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Za(t){return new qa(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Ja(t.target.error);n(e)}})}var Ka=!1;function Ja(t){var e=Ua._t((0,C.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Br("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ka||(Ka=!0,setTimeout(function(){throw r},0)),r}}return t}var Qa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,x.ZT)(e,t),e}(Pa);function za(t,e){var n=Xr(t);return Ua.It(n.Mt,e)}var Ha=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Qo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(oi.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Is())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ni(this.mutations,t.mutations,function(t,e){return Wo(t,e)})&&ni(this.baseMutations,t.baseMutations,function(t,e){return Wo(t,e)})},t}(),Wa=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Yr(e.mutations.length===r.length);for(var i=bs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Ya=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=oi.min()),void 0===o&&(o=oi.min()),void 0===s&&(s=pi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Xa=function(t){this.Lt=t};function $a(t,e){if(e.document)return Ws(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Si.fromSegments(e.noDocument.path),r=iu(e.noDocument.readTime),i=ji.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Si.fromSegments(e.unknownDocument.path);return r=iu(e.unknownDocument.version),ji.newUnknownDocument(o,r)}return Wr()}function tu(t,e,n){var r=eu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Bs(t,e.key),fields:e.data.value.mapValue.fields,updateTime:qs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new _a(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=ru(e.version);return s=e.hasCommittedMutations,new _a(null,new Ia(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=ru(e.version);return new _a(new Ea(c,h),null,null,!0,r,i)}return Wr()}function eu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function nu(t){var e=new ii(t[0],t[1]);return oi.fromTimestamp(e)}function ru(t){var e=t.toTimestamp();return new ma(e.seconds,e.nanoseconds)}function iu(t){var e=new ii(t.seconds,t.nanoseconds);return oi.fromTimestamp(e)}function ou(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Xs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Xs(t.Lt,e)}),o=ii.fromMillis(e.localWriteTimeMs);return new Ha(e.batchId,o,n,i)}function su(t){var e,n,r=iu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?iu(t.lastLimboFreeSnapshotVersion):oi.min();return void 0!==t.query.documents?(Yr(1===(n=t.query).documents.length),e=wo(lo(Js(n.documents[0])))):e=function(t){return wo(ea(t))}(t.query),new Ya(e,t.targetId,0,t.lastListenSequenceNumber,r,i,pi.fromBase64String(t.resumeToken))}function au(t,e){var n,r=ru(e.snapshotVersion),i=ru(e.lastLimboFreeSnapshotVersion);n=Qi(e.target)?$s(t.Lt,e.target):ta(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Aa(e.targetId,Ki(e.target),r,o,e.sequenceNumber,i,n)}function uu(t){var e=ea({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?bo(e,e.limit,"L"):e}var cu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return hu(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:iu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return hu(t).put({bundleId:(n=e).id,createTime:ru(Vs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return lu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:uu(e.bundledQuery),readTime:iu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return lu(t).put(function(t){return{name:t.name,readTime:ru(Vs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function hu(t){return za(t,Ca.store)}function lu(t){return za(t,Ra.store)}var fu=function(){function t(){this.Bt=new du}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),qa.resolve()},t.prototype.getCollectionParents=function(t,e){return qa.resolve(this.Bt.getEntries(e))},t}(),du=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ds(hi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ds(hi.comparator)).toArray()},t}(),pu=function(){function t(){this.qt=new du}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:da(i)};return gu(t).put(o)}return qa.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ri(e),""],!1,!0);return gu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ya(o.parent))}return n})},t}();function gu(t){return za(t,ka.store)}var yu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},mu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function vu(t,e,n){var r=t.store(ba.store),i=t.store(Ta.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Yr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Ta.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return qa.waitFor(o).next(function(){return c})}function wu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Wr();e=t.noDocument}return JSON.stringify(e).length}mu.DEFAULT_COLLECTION_PERCENTILE=10,mu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mu.DEFAULT=new mu(41943040,mu.DEFAULT_COLLECTION_PERCENTILE,mu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mu.DISABLED=new mu(-1,0,0);var bu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Yr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Iu(t).$t({index:ba.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Eu(t),s=Iu(t);return s.add({}).next(function(a){Yr("number"==typeof a);for(var u=new Ha(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Ys(t.Lt,e)}),i=n.mutations.map(function(e){return Ys(t.Lt,e)});return new ba(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ds(function(t,e){return ei(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=Ta.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Ta.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),qa.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Iu(t).get(e).next(function(t){return t?(Yr(t.userId===n.userId),ou(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?qa.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Iu(t).$t({index:ba.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Yr(e.batchId>=r),o=ou(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Iu(t).$t({index:ba.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Iu(t).Nt(ba.userMutationsIndex,n).next(function(t){return t.map(function(t){return ou(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ta.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Eu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=ya(r[1]);if(a===n.userId&&e.path.isEqual(c))return Iu(t).get(u).next(function(t){if(!t)throw Wr();Yr(t.userId===n.userId),o.push(ou(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ds(ei),i=[];return e.forEach(function(e){var o=Ta.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Eu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=ya(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),qa.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Ta.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ds(ei);return Eu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=ya(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Iu(t).get(e).next(function(t){if(null===t)throw Wr();Yr(t.userId===n.userId),r.push(ou(n.R,t))}))}),qa.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return vu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),qa.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return qa.resolve();var r=IDBKeyRange.lowerBound(Ta.prefixForUser(e.userId)),i=[];return Eu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=ya(t[1]);i.push(o)}else r.done()}).next(function(){Yr(0===i.length)})})},t.prototype.containsKey=function(t,e){return Tu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return _u(t).get(this.userId).next(function(t){return t||new wa(e.userId,-1,"")})},t}();function Tu(t,e,n){var r=Ta.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Eu(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Iu(t){return za(t,ba.store)}function Eu(t){return za(t,Ta.store)}function _u(t){return za(t,wa.store)}var Su=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Au=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Su(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return oi.fromTimestamp(new ii(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Du(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Yr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Du(t).$t(function(s,a){var u=su(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return qa.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Du(t).$t(function(t,n){var r=su(n);e(r)})},t.prototype.Xt=function(t){return Nu(t).get(Na.key).next(function(t){return Yr(null!==t),t})},t.prototype.Zt=function(t,e){return Nu(t).put(Na.key,e)},t.prototype.te=function(t,e){return Du(t).put(au(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Ki(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Du(t).$t({range:r,index:Aa.queryTargetsIndexName},function(t,n,r){var o=su(n);Ji(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=ku(t);return e.forEach(function(e){var s=da(e.path);i.push(o.put(new Da(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),qa.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=ku(t);return qa.forEach(e,function(e){var o=da(e.path);return qa.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ku(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ku(t),i=Is();return r.$t({range:n,kt:!0},function(t,e,n){var r=ya(t[1]),o=new Si(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=da(e.path),r=IDBKeyRange.bound([n],[ri(n)],!1,!0),i=0;return ku(t).$t({index:Da.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Du(t).get(e).next(function(t){return t?su(t):null})},t}();function Du(t){return za(t,Aa.store)}function Nu(t){return za(t,Na.store)}function ku(t){return za(t,Da.store)}function xu(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){if(t.code!==jr.FAILED_PRECONDITION||t.message!==La)throw t;return Jr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Cu(t,e){var n=t[1],r=e[1],i=ei(t[0],e[0]);return 0===i?ei(n,r):i}var Ru=function(){function t(t){this.ne=t,this.buffer=new ds(Cu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Cu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Ou=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Jr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,x.mG)(e,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ja(e=n.sent())?(Jr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,xu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Lu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return qa.resolve(Gr.o);var r=new Ru(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Jr("LruGarbageCollector","Garbage collection skipped; disabled"),qa.resolve(yu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Jr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),yu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Jr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Kr()<=R.in.DEBUG&&Jr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),qa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Pu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Lu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Mu(t,n)},t.prototype.removeReference=function(t,e,n){return Mu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Mu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return _u(t).Ot(function(r){return Tu(t,r,e).next(function(t){return t&&(n=!0),qa.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),ku(t).delete([0,da(s.path)])})});i.push(u)}}).next(function(){return qa.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Mu(t,e)},t.prototype.we=function(t,e){var n,r=ku(t),i=Gr.o;return r.$t({index:Da.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Gr.o&&e(new Si(ya(n)),i),i=s,n=o):i=Gr.o}).next(function(){i!==Gr.o&&e(new Si(ya(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Mu(t,e){return ku(t).put(function(t,e){return new Da(0,da(t.path),e)}(e,t.currentSequenceNumber))}var qu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){ai(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return ui(this.inner)},t}(),Fu=function(){function t(){this.changes=new qu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:oi.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:ji.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?qa.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Uu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ju(t).put(Bu(e),n)},t.prototype.removeEntry=function(t,e){var n=ju(t),r=Bu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ju(t).get(Bu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ju(t).get(Bu(e)).next(function(t){return{document:n.ye(e,t),size:wu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=ys();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=ys(),i=new hs(Si.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,wu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return qa.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ju(t).$t({range:r},function(t,e,r){for(var s=Si.fromSegments(t);o&&Si.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=ys(),o=e.path.length+1,s={};if(n.isEqual(oi.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=eu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=_a.collectionReadTimeIndex}return ju(t).$t(s,function(t,n,s){if(t.length===o){var a=$a(r.R,n);e.path.isPrefixOf(a.key.path)?_o(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Vu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Gu(t).get(Sa.key).next(function(t){return Yr(!!t),t})},t.prototype.me=function(t,e){return Gu(t).put(Sa.key,e)},t.prototype.ye=function(t,e){if(e){var n=$a(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(oi.min()))return n}return ji.newInvalidDocument(t)},t}(),Vu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new qu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,x.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ds(function(t,e){return ei(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=tu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=wu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=tu(e.Ie.R,ji.newNoDocument(o,oi.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),qa.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Fu);function Gu(t){return za(t,Sa.store)}function ju(t){return za(t,_a.store)}function Bu(t){return t.path.toArray()}var Zu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Yr(n<r&&n>=0&&r<=11);var o=new Fa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(va.store)}(t),function(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath}),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ta.store)}(t),Ku(t),function(t){t.createObjectStore(_a.store)}(t));var s=qa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Da.store),t.deleteObjectStore(Aa.store),t.deleteObjectStore(Na.store)}(t),Ku(t)),s=s.next(function(){return function(t){var e=t.store(Na.store),n=new Na(0,0,oi.min().toTimestamp(),0);return e.put(Na.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ba.store).Nt().next(function(n){t.deleteObjectStore(ba.store),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0});var r=e.store(ba.store),i=n.map(function(t){return r.put(t)});return qa.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Sa.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(_a.store);e.createIndex(_a.readTimeIndex,_a.readTimeIndexPath,{unique:!1}),e.createIndex(_a.collectionReadTimeIndex,_a.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath})}(t),function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(_a.store).$t(function(t,n){e+=wu(n)}).next(function(){var n=new Sa(e);return t.store(Sa.store).put(Sa.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(wa.store),r=t.store(ba.store);return n.Nt().next(function(n){return qa.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ba.userMutationsIndex,i).next(function(r){return qa.forEach(r,function(r){Yr(r.userId===n.userId);var i=ou(e.R,r);return vu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Da.store),n=t.store(_a.store);return t.store(Na.store).get(Na.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new hi(n),s=function(t){return[0,da(t)]}(o);r.push(e.get(s).next(function(n){return n?qa.resolve():function(n){return e.put(new Da(0,da(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return qa.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ka.store,{keyPath:ka.keyPath});var n=e.store(ka.store),r=new du,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:da(i)})}};return e.store(_a.store).$t({kt:!0},function(t,e){var n=new hi(t);return i(n.popLast())}).next(function(){return e.store(Ta.store).$t({kt:!0},function(t,e){var n=ya(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Aa.store);return n.$t(function(t,r){var i=su(r),o=au(e.R,i);return n.put(o)})},t}();function Ku(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.documentTargetsIndex,Da.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store,{keyPath:Aa.keyPath}).createIndex(Aa.queryTargetsIndexName,Aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Na.store)}var Ju="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Br(jr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Pu(this,i),this.Le=n+"main",this.R=new Xa(u),this.Be=new Ua(this.Le,11,new Zu(this.R)),this.qe=new Au(this.referenceDelegate,this.R),this.Ut=new pu,this.Ue=function(t,e){return new Uu(t,e)}(this.R,this.Ut),this.Ke=new cu,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Br(jr.FAILED_PRECONDITION,Ju);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Gr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,x.mG)(e,void 0,void 0,function(){return(0,x.Jh)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,x.mG)(e,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,x.mG)(e,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Hu(e).put(new xa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(ja(e))return Jr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Jr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return zu(t).get(va.key).next(function(t){return qa.resolve(e.tn(t))})},t.prototype.en=function(t){return Hu(t).delete(this.clientId)},t.prototype.nn=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e,n,r=this;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=za(t,xa.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return qa.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?qa.resolve(!0):zu(t).get(va.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Br(jr.FAILED_PRECONDITION,Ju);return!1}}return!(!e.networkEnabled||!e.inForeground)||Hu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Jr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,x.mG)(this,void 0,void 0,function(){var t=this;return(0,x.Jh)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[va.store,xa.store],function(e){var n=new Qa(e,Gr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Hu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return bu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Jr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Oa,function(o){return r=new Qa(o,i.Ne?i.Ne.next():Gr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Qr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Br(jr.FAILED_PRECONDITION,La);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return zu(t).get(va.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Br(jr.FAILED_PRECONDITION,Ju)})},t.prototype.Ze=function(t){var e=new va(this.clientId,this.allowTabSynchronization,Date.now());return zu(t).put(va.key,e)},t.yt=function(){return Ua.yt()},t.prototype.Xe=function(t){var e=this,n=zu(t);return n.get(va.key).next(function(t){return e.tn(t)?(Jr("IndexedDbPersistence","Releasing primary lease."),n.delete(va.key)):qa.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Qr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),(0,C.G6)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Jr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Qr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function zu(t){return za(t,va.store)}function Hu(t){return za(t,xa.store)}function Wu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Yu=function(t,e){this.progress=t,this.wn=e},Xu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Si.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):mo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Si(e)).next(function(t){var e=vs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=vs();return this.Ut.getCollectionParents(t,i).next(function(s){return qa.forEach(s,function(s){var a=function(t,e){return new co(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=ji.newInvalidDocument(c),r=r.insert(c,h)),zo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){_o(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Is(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof $o&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),$u=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Is(),i=Is(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),tc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(oi.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(fo(e)||po(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Kr()<=R.in.DEBUG&&Jr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Eo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ds(So(t));return e.forEach(function(e,r){_o(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Kr()<=R.in.DEBUG&&Jr("QueryEngine","Using full collection scan to execute query:",Eo(e)),this.Sn.getDocumentsMatchingQuery(t,e,oi.min())},t}(),ec=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new hs(ei),this.kn=new qu(function(t){return Ki(t)},Ji),this.$n=oi.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Xu(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function nc(t,e,n,r){return new ec(t,e,n,r)}function rc(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,x.Jh)(this,function(s){switch(s.label){case 0:return n=Xr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Xu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=Is(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function ic(t,e){var n=Xr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=qa.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Yr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function oc(t){var e=Xr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function sc(t,e){var n=Xr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Yr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=ys();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(ac(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(oi.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return qa.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function ac(t,e,n,r,i){var o=Is();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=ys();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(oi.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Jr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function uc(t,e){var n=Xr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function cc(t,e){var n=Xr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?qa.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Ya(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function hc(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:r=Xr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!ja(s=a.sent()))throw s;return Jr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function lc(t,e,n){var r=Xr(t),i=oi.min(),o=Is();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Xr(t),i=r.kn.get(n);return void 0!==i?qa.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,wo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:oi.min(),n?o:Is())}).next(function(t){return{documents:t,Bn:o}})})}function fc(t,e){var n=Xr(t),r=Xr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function dc(t){var e=Xr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Xr(t),i=ys(),o=eu(n),s=ju(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:_a.readTimeIndex,range:a},function(t,e){var n=$a(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:nu(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function pc(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){return[2,(e=Xr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=ju(t),n=oi.min();return e.$t({index:_a.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=nu(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function gc(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return(0,x.Jh)(this,function(p){switch(p.label){case 0:for(i=Xr(t),o=Is(),s=ys(),a=bs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,cc(i,function(t){return wo(lo(hi.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return ac(t,f,s,oi.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function yc(t,e,n){return void 0===n&&(n=Is()),(0,x.mG)(this,void 0,void 0,function(){var r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return[4,cc(t,wo(uu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Xr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Vs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(pi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var mc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return qa.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Vs(n.createTime)}),qa.resolve()},t.prototype.getNamedQuery=function(t,e){return qa.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:uu(t.bundledQuery),readTime:Vs(t.readTime)}}(e)),qa.resolve()},t}(),vc=function(){function t(){this.Wn=new ds(wc.Gn),this.zn=new ds(wc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new wc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new wc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Si(new hi([])),r=new wc(n,t),i=new wc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Si(new hi([])),n=new wc(e,t),r=new wc(e,t+1),i=Is();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new wc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),wc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Si.comparator(t.key,e.key)||ei(t.ns,e.ns)},t.Hn=function(t,e){return ei(t.ns,e.ns)||Si.comparator(t.key,e.key)},t}(),bc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ds(wc.Gn)}return t.prototype.checkEmpty=function(t){return qa.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ha(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new wc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return qa.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return qa.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return qa.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return qa.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return qa.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new wc(e,0),i=new wc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),qa.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ds(ei);return e.forEach(function(t){var e=new wc(t,0),i=new wc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),qa.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Si.isDocumentKey(i)||(i=i.child(""));var o=new wc(new Si(i),0),s=new ds(ei);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),qa.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Yr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return qa.forEach(e.mutations,function(i){var o=new wc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new wc(e,0),r=this.rs.firstAfterOrEqual(n);return qa.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return qa.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Tc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new hs(Si.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return qa.resolve(n?n.document.clone():ji.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=ys();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():ji.newInvalidDocument(t))}),qa.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=ys(),i=new Si(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||_o(e,u)&&(r=r.insert(u.key,u.clone()))}return qa.resolve(r)},t.prototype.fs=function(t,e){return qa.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Ic(this)},t.prototype.getSize=function(t){return qa.resolve(this.size)},t}(),Ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,x.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),qa.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Fu),Ec=function(){function t(t){this.persistence=t,this.ds=new qu(function(t){return Ki(t)},Ji),this.lastRemoteSnapshotVersion=oi.min(),this.highestTargetId=0,this.ws=0,this._s=new vc,this.targetCount=0,this.ys=Su.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),qa.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return qa.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return qa.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),qa.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),qa.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Su(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,qa.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),qa.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,qa.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),qa.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return qa.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return qa.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),qa.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),qa.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),qa.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return qa.resolve(n)},t.prototype.containsKey=function(t,e){return qa.resolve(this._s.containsKey(e))},t}(),_c=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Gr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Ec(this),this.Ut=new fu,this.Ue=function(t,e){return new Tc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Xa(e),this.Ke=new mc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new bc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Jr("MemoryPersistence","Starting transaction:",t);var i=new Sc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return qa.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Sc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,x.ZT)(e,t),e}(Pa),Ac=function(){function t(t){this.persistence=t,this.As=new vc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Wr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),qa.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),qa.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),qa.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qa.forEach(this.vs,function(r){var i=Si.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return qa.or([function(){return qa.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Dc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Nc(t,e){return"firestore_clients_"+t+"_"+e}function kc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function xc(t,e){return"firestore_targets_"+t+"_"+e}Dc.UNAUTHENTICATED=new Dc(null),Dc.GOOGLE_CREDENTIALS=new Dc("google-credentials-uid"),Dc.FIRST_PARTY=new Dc("first-party-uid");var Cc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Br(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Qr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Rc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Br(i.error.code,i.error.message)),o?new t(e,i.state,r):(Qr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Oc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=_s(),s=0;i&&s<r.activeTargetIds.length;++s)i=_i(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Qr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Lc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Qr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Pc=function(){function t(){this.activeTargetIds=_s()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Mc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new hs(ei),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Nc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Pc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return(0,x.Jh)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Nc(this.persistenceKey,r)))&&(o=Oc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(xc(this.persistenceKey,t));if(n){var r=Rc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(xc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Jr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Jr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Jr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Jr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,x.mG)(e,void 0,void 0,function(){var t,e,r,i,o,s;return(0,x.Jh)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Gr.o;if(null!=t)try{var n=JSON.parse(t);Yr("number"==typeof n),e=n}catch(t){Qr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Gr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Cc(this.currentUser,t,e,n),i=kc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=kc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=xc(this.persistenceKey,t),i=new Rc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Oc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Cc.Vs(new Dc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Rc.Vs(r,e)},t.prototype.js=function(t){return Lc.Vs(t)},t.prototype.ii=function(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Jr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=_s();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),qc=function(){function t(){this.li=new Pc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Pc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Fc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Uc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Jr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Jr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Vc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Gc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),jc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,x.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Vr;s.listenOnce(Mr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Pr.NO_ERROR:var e=s.getResponseJson();Jr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Pr.TIMEOUT:Jr("Connection",'RPC "'+t+'" timed out'),o(new Br(jr.DEADLINE_EXCEEDED,"Request time out"));break;case Pr.HTTP_ERROR:var n=s.getStatus();if(Jr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(jr).indexOf(e)>=0?e:jr.UNKNOWN}(r.status);o(new Br(a,r.message))}else o(new Br(jr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Br(jr.UNAVAILABLE,"Connection failed."));break;default:Wr()}}finally{Jr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new xr,i=Ee(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Fr({})),this.Fi(o.initMessageHeaders,e),(0,C.uI)()||(0,C.b$)()||(0,C.d)()||(0,C.w1)()||(0,C.Mn)()||(0,C.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Jr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Gc({Ei:function(t){c?Jr("Connection","Not sending because WebChannel is closed:",t):(u||(Jr("Connection","Opening WebChannel transport."),a.open(),u=!0),Jr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Ur.EventType.OPEN,function(){c||Jr("Connection","WebChannel transport opened.")}),l(a,Ur.EventType.CLOSE,function(){c||(c=!0,Jr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Ur.EventType.ERROR,function(t){c||(c=!0,zr("Connection","WebChannel transport errored:",t),h.Vi(new Br(jr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Ur.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Yr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Jr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=rs[t];if(void 0!==e)return cs(e)}(i),s=r.message;void 0===o&&(o=jr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Br(o,s)),a.close()}else Jr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,qr.STAT_EVENT,function(t){10===t.stat?Jr("Connection","Detected buffering proxy"):11===t.stat&&Jr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Jr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Jr("RestConnection","Received: ",t),t},function(e){throw zr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Vc[t]},t}());function Bc(){return"undefined"!=typeof window?window:null}function Zc(){return"undefined"!=typeof document?document:null}function Kc(t){return new Ms(t,!0)}var Jc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Jr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Qc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Jc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===jr.RESOURCE_EXHAUSTED?(Qr(e.toString()),Qr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===jr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Br(jr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,x.mG)(t,void 0,void 0,function(){return(0,x.Jh)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Jr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Jr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),zc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,x.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Wr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Yr(void 0===e||"string"==typeof e),pi.fromBase64String(e||"")):(Yr(void 0===e||e instanceof Uint8Array),pi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?jr.UNKNOWN:cs(t.code);return new Br(e,t.message||"")}(a);n=new ks(r,i,o,s||null)}else if("documentChange"in e){i=Zs(t,(r=e.documentChange).document.name),o=Vs(r.document.updateTime);var a=new Vi({mapValue:{fields:r.document.fields}}),u=(s=ji.newFoundDocument(i,o,a),r.targetIds||[]);n=new Ds(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Zs(t,(r=e.documentDelete).document),o=r.readTime?Vs(r.readTime):oi.min(),a=ji.newNoDocument(i,o),n=new Ds([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Zs(t,(r=e.documentRemove).document),n=new Ds([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Wr();var c=e.filter;i=new as(r=c.count||0),n=new Ns(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return oi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?oi.min():e.readTime?Vs(e.readTime):oi.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Qs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Qi(r)?{documents:$s(t,r)}:{query:ta(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Fs(t,e.resumeToken):e.snapshotVersion.compareTo(oi.min())>0&&(n.readTime=qs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Wr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Qs(this.R),e.removeTarget=t,this.cr(e)},e}(Qc),Hc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,x.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Yr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Yr(void 0!==e),t.map(function(t){return function(t,e){var n=Vs(t.updateTime?t.updateTime:e);return n.isEqual(oi.min())&&(n=Vs(e)),new Bo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Vs(t.commitTime);return this.listener.Tr(n,e)}return Yr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Qs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ys(e.R,t)})};this.cr(n)},e}(Qc),Wc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,x.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new Br(jr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===jr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Br(jr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===jr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Br(jr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Yc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Qr(e),this.Vr=!1):Jr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Xc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,x.mG)(o,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return ah(this)?(Jr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return(e=Xr(t)).Or.add(4),[4,th(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,$c(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Yc(n,r)};function $c(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:if(!ah(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function th(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function eh(t,e){var n=Xr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),sh(n)?oh(n):Ih(n).er()&&rh(n,e))}function nh(t,e){var n=Xr(t),r=Ih(n);n.$r.delete(e),r.er()&&ih(n,e),0===n.$r.size&&(r.er()?r.ir():ah(n)&&n.Br.set("Unknown"))}function rh(t,e){t.qr.U(e.targetId),Ih(t).mr(e)}function ih(t,e){t.qr.U(e),Ih(t).yr(e)}function oh(t){t.qr=new Cs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Ih(t).start(),t.Br.Sr()}function sh(t){return ah(t)&&!Ih(t).tr()&&t.$r.size>0}function ah(t){return 0===Xr(t).Or.size}function uh(t){t.qr=void 0}function ch(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){return t.$r.forEach(function(e,n){rh(t,e)}),[2]})})}function hh(t,e){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(n){return uh(t),sh(t)?(t.Br.Nr(e),oh(t)):t.Br.set("Unknown"),[2]})})}function lh(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o;return(0,x.Jh)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ks&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,x.Jh)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Jr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,fh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Ds?t.qr.X(e):e instanceof Ns?t.qr.rt(e):t.qr.et(e),n.isEqual(oi.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,oc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(pi.EMPTY_BYTE_STRING,n.snapshotVersion)),ih(t,e);var r=new Ya(n.target,e,1,n.sequenceNumber);rh(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Jr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,fh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function fh(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r=this;return(0,x.Jh)(this,function(i){switch(i.label){case 0:if(!ja(e))throw e;return t.Or.add(1),[4,th(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return oc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,x.mG)(r,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return Jr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,$c(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function dh(t,e){return e().catch(function(n){return fh(t,n,e)})}function ph(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n,r,i,o;return(0,x.Jh)(this,function(s){switch(s.label){case 0:e=Xr(t),n=Eh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return ah(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,uc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Eh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,fh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return gh(e)&&yh(e),[2]}})})}function gh(t){return ah(t)&&!Eh(t).tr()&&t.kr.length>0}function yh(t){Eh(t).start()}function mh(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){return Eh(t).Ar(),[2]})})}function vh(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n,r;return(0,x.Jh)(this,function(i){for(e=Eh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function wh(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Wa.from(r,e,n),[4,dh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,ph(t)];case 2:return o.sent(),[2]}})})}function bh(t,e){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e&&Eh(t).pr?[4,function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return us(r=e.code)&&r!==jr.ABORTED?(n=t.kr.shift(),Eh(t).sr(),[4,dh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,ph(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return gh(t)&&yh(t),[2]}})})}function Th(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return n=Xr(t),e?(n.Or.delete(2),[4,$c(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,th(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Ih(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Xr(t);return r.br(),new zc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ch.bind(null,t),Ri:hh.bind(null,t),_r:lh.bind(null,t)}),t.Mr.push(function(n){return(0,x.mG)(e,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),sh(t)?oh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),uh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Eh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Xr(t);return r.br(),new Hc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:mh.bind(null,t),Ri:bh.bind(null,t),Ir:vh.bind(null,t),Tr:wh.bind(null,t)}),t.Mr.push(function(n){return(0,x.mG)(e,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,ph(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Jr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var _h=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ma,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Br(jr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Sh(t,e){if(Qr("AsyncQueue",e+": "+t),ja(t))return new Br(jr.UNAVAILABLE,e+": "+t);throw t}var Ah=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Si.comparator(e.key,n.key)}:function(t,e){return Si.comparator(t.key,e.key)},this.keyedMap=vs(),this.sortedSet=new hs(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Dh=function(){function t(){this.Qr=new hs(Si.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Wr():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Nh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Ah.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&To(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),kh=function(){this.Wr=void 0,this.listeners=[]},xh=function(){this.queries=new qu(function(t){return Io(t)},To),this.onlineState="Unknown",this.Gr=new Set};function Ch(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,x.Jh)(this,function(c){switch(c.label){case 0:if(n=Xr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new kh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Sh(a,"Initialization of query '"+Eo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Ph(n),[2]}})})}function Rh(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,x.Jh)(this,function(a){return n=Xr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Oh(t,e){for(var n=Xr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Ph(n)}function Lh(t,e,n){var r=Xr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Ph(t){t.Gr.forEach(function(t){t.next()})}var Mh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Nh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Nh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),qh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Fh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Zs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ws(this.R,t.document,!1):ji.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Vs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Fh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Is()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e,n,r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return[4,gc(this.localStore,new Fh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,yc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Yu(Object.assign({},this.progress),t))]}})})}}();var Uh=function(t){this.key=t},Vh=function(t){this.key=t},Gh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Is(),this.mutatedKeys=Is(),this.lo=So(t),this.fo=new Ah(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Dh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=fo(this.query)&&i.size===this.query.limit?i.last():null,c=po(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=_o(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),fo(this.query)||po(this.query))for(;s.size>this.query.limit;){var h=fo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Nh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Dh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Is(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Vh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Uh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Is();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Nh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),jh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Bh=function(t){this.key=t,this.bo=!1},Zh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new qu(function(t){return Io(t)},To),this.Vo=new Map,this.So=new Set,this.Do=new hs(Si.comparator),this.Co=new Map,this.No=new vc,this.xo={},this.Fo=new Map,this.ko=Su.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Kh(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:return n=bl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,cc(n.localStore,wo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Jh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&eh(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Jh(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,x.Jh)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,lc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(ol(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,lc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Gh(e,i.Bn),s=o._o(i.documents),a=As.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),ol(t,n,u.To),c=new jh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Qh(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return n=Xr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!To(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,hc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),nh(n.remoteStore,r.targetId),rl(n,r.targetId)}).catch(xu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return rl(n,r.targetId),[4,hc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function zh(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:r=Tl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Xr(t),i=ii.now(),o=e.reduce(function(t,e){return t.add(e.key)},Is());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Ho(c,n.get(c.key));null!=h&&s.push(new $o(c.key,h,Gi(h.value.mapValue),Zo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new hs(ei)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,ul(r,i.changes)];case 3:return a.sent(),[4,ph(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Sh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Hh(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:n=Xr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,sc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Yr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Yr(r.bo):t.removedDocuments.size>0&&(Yr(r.bo),r.bo=!1))}),[4,ul(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,xu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Wh(t,e,n){var r=Xr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Xr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Ph(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Yh(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,x.Jh)(this,function(c){switch(c.label){case 0:return(r=Xr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new hs(Si.comparator)).insert(o,ji.newNoDocument(o,oi.min())),a=Is().add(o),u=new Ss(oi.min(),new Map,new ds(ei),s,a),[4,Hh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),al(r),[3,4];case 2:return[4,hc(r.localStore,e,!1).then(function(){return rl(r,e,n)}).catch(xu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Xh(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:n=Xr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,ic(n.localStore,e)];case 2:return i=o.sent(),nl(n,r,null),el(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,ul(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,xu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function $h(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:r=Xr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Yr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),nl(r,e,n),el(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,ul(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,xu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function tl(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:ah((n=Xr(t)).remoteStore)||Jr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Xr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Sh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function el(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function nl(t,e,n){var r=Xr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function rl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||il(t,e)})}function il(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(nh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),al(t))}function ol(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Uh?(t.No.addReference(o.key,e),sl(t,o)):o instanceof Vh?(Jr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||il(t,o.key)):Wr()}}function sl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Jr("SyncEngine","New document in limbo: "+n),t.So.add(r),al(t))}function al(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Si(hi.fromString(e)),r=t.ko.next();t.Co.set(r,new Bh(n)),t.Do=t.Do.insert(n,r),eh(t.remoteStore,new Ya(wo(lo(n.path)),r,2,Gr.o))}}function ul(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:return r=Xr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=$u.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return(0,x.Jh)(this,function(h){switch(h.label){case 0:n=Xr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return qa.forEach(e,function(e){return qa.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return qa.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!ja(r=h.sent()))throw r;return Jr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function cl(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return(n=Xr(t)).currentUser.isEqual(e)?[3,3]:(Jr("SyncEngine","User change. New user:",e.toKey()),[4,rc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Br(jr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,ul(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function hl(t,e){var n=Xr(t),r=n.Co.get(e);if(r&&r.bo)return Is().add(r.key);var i=Is(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function ll(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return[4,lc((n=Xr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&ol(n,e.targetId,i.To),i)]}})})}function fl(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){return[2,dc((e=Xr(t)).localStore).then(function(t){return ul(e,t)})]})})}function dl(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o;return(0,x.Jh)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Xr(t),r=Xr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):qa.resolve(null)})})}((i=Xr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,ph(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(nl(i,e,r||null),el(i,e),function(t,e){Xr(Xr(t)._n).Gt(e)}(i.localStore,e)):Wr(),s.label=4;case 4:return[4,ul(i,o)];case 5:return s.sent(),[3,7];case 6:Jr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function pl(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,x.Jh)(this,function(c){switch(c.label){case 0:return bl(n=Xr(t)),Tl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,gl(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Th(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)eh(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return rl(n,e),hc(n.localStore,e,!0)}),nh(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,gl(n,a)];case 5:return c.sent(),function(t){var e=Xr(t);e.Co.forEach(function(t,n){nh(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new hs(Si.comparator)}(n),n.$o=!1,[4,Th(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function gl(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return(0,x.Jh)(this,function(g){switch(g.label){case 0:n=Xr(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,cc(n.localStore,wo(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,ll(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,fc(n.localStore,a)];case 8:return p=g.sent(),[4,cc(n.localStore,p)];case 9:return u=g.sent(),[4,Jh(n,yl(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function yl(t){return ho(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ml(t){var e=Xr(t);return Xr(Xr(e.localStore).persistence).fn()}function vl(t,e,n,r){return(0,x.mG)(this,void 0,void 0,function(){var i,o,s;return(0,x.Jh)(this,function(a){switch(a.label){case 0:return(i=Xr(t)).$o?(Jr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,dc(i.localStore)];case 3:return o=a.sent(),s=Ss.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,ul(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,hc(i.localStore,e,!0)];case 6:return a.sent(),rl(i,e,r),[3,8];case 7:Wr(),a.label=8;case 8:return[2]}})})}function wl(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return(0,x.Jh)(this,function(f){switch(f.label){case 0:if(!(r=bl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Jr("SyncEngine","Adding an already active target "+s),[3,5]):[4,fc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,cc(r.localStore,a)];case 3:return u=f.sent(),[4,Jh(r,yl(a),u.targetId,!1)];case 4:f.sent(),eh(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,hc(r.localStore,t,!1).then(function(){nh(r.remoteStore,t),rl(r,t)}).catch(xu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function bl(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Hh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yh.bind(null,e),e.vo._r=Oh.bind(null,e.eventManager),e.vo.Mo=Lh.bind(null,e.eventManager),e}function Tl(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$h.bind(null,e),e}var Il=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return this.R=Kc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return nc(this.persistence,new tc,t.initialUser,this.R)},t.prototype.qo=function(t){return new _c(Ac.bs,this.R)},t.prototype.Bo=function(t){return new qc},t.prototype.terminate=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),El=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,x.ZT)(e,t),e.prototype.initialize=function(e){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,pc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,Tl(this.Qo.syncEngine)];case 4:return n.sent(),[4,ph(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return nc(this.persistence,new tc,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Ou(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Wu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?mu.withCacheSize(this.cacheSizeBytes):mu.DEFAULT;return new Qu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Bc(),Zc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new qc},e}(Il),_l=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,x.ZT)(e,t),e.prototype.initialize=function(e){return(0,x.mG)(this,void 0,void 0,function(){var n,r=this;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Mc?(this.sharedClientState.syncEngine={ui:dl.bind(null,n),ai:vl.bind(null,n),hi:wl.bind(null,n),fn:ml.bind(null,n),ci:fl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return(0,x.mG)(r,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return[4,pl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Bc();if(!Mc.yt(e))throw new Br(jr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Wu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Mc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(El),Sl=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n=this;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Wh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=cl.bind(null,this.syncEngine),[4,Th(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new xh},t.prototype.createDatastore=function(t){var e=Kc(t.databaseInfo.databaseId),n=new jc(t.databaseInfo);return function(t,e,n){return new Wc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Wh(s.syncEngine,t,0)},o=Uc.yt()?new Uc:new Fc,new Xc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Zh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e=Xr(t),Jr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,th(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Al=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Dl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ma,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e,n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new qh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n=this;return(0,x.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Br(jr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a;return(0,x.Jh)(this,function(u){switch(u.label){case 0:return n=Xr(t),r=Qs(n.R)+"/documents",i={documents:e.map(function(t){return Bs(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Yr(!!e.found);var n=Zs(t,e.found.name),r=Vs(e.found.updateTime),i=new Vi({mapValue:{fields:e.found.fields}});return ji.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Yr(!!e.missing),Yr(!!e.readTime);var n=Zs(t,e.missing),r=Vs(e.readTime);return ji.newNoDocument(n,r)}(t,e):Wr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Yr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new os(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e=this;return(0,x.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Si.fromPath(n);e.mutations.push(new ss(r,e.precondition(r)))}),[4,function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return n=Xr(t),r=Qs(n.R)+"/documents",i={writes:e.map(function(t){return Ys(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Wr();e=oi.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Br(jr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Zo.updateTime(e):Zo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(oi.min()))throw new Br(jr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Zo.updateTime(e)}return Zo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Nl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Jc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,x.mG)(t,void 0,void 0,function(){var t,e,n=this;return(0,x.Jh)(this,function(r){return t=new Dl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Ii(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!us(e)}return!1},t}(),kl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Dc.UNAUTHENTICATED,this.clientId=ti.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return(0,x.mG)(r,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return Jr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Br(jr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ma;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,x.mG)(t,void 0,void 0,function(){var t,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Sh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function xl(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Jr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return(0,x.mG)(i,void 0,void 0,function(){return(0,x.Jh)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,rc(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Cl(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Rl(t)];case 1:return n=i.sent(),Jr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return(0,x.mG)(this,void 0,void 0,function(){var n,r;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return(n=Xr(t)).asyncQueue.verifyOperationInProgress(),Jr("RemoteStore","RemoteStore received new credentials"),r=ah(n),n.Or.add(3),[4,th(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,$c(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Rl(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Jr("FirestoreClient","Using default OfflineComponentProvider"),[4,xl(t,new Il)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Ol(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Jr("FirestoreClient","Using default OnlineComponentProvider"),[4,Cl(t,new Sl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Ll(t){return Rl(t).then(function(t){return t.persistence})}function Pl(t){return Rl(t).then(function(t){return t.localStore})}function Ml(t){return Ol(t).then(function(t){return t.remoteStore})}function ql(t){return Ol(t).then(function(t){return t.syncEngine})}function Fl(t){return(0,x.mG)(this,void 0,void 0,function(){var e,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return[4,Ol(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Kh.bind(null,e.syncEngine),n.onUnlisten=Qh.bind(null,e.syncEngine),n)]}})})}function Ul(t,e,n){var r=this;void 0===n&&(n={});var i=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(r,void 0,void 0,function(){var r;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Al({next:function(o){e.enqueueAndForget(function(){return Rh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Br(jr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Br(jr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Mh(lo(n.path),o,{includeMetadataChanges:!0,so:!0});return Ch(t,s)},[4,Fl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Vl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(r,void 0,void 0,function(){var r;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Al({next:function(n){e.enqueueAndForget(function(){return Rh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Br(jr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Mh(n,o,{includeMetadataChanges:!0,so:!0});return Ch(t,s)},[4,Fl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Gl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},jl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Bl=new Map,Zl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Kl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Dc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Jl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ql=function(){function t(t){var e=this;this.currentUser=Dc.UNAUTHENTICATED,this.oc=new Ma,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Jr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Jr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Jr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Yr("string"==typeof n.accessToken),new Zl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,x.mG)(n,void 0,void 0,function(){return(0,x.Jh)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Yr(null===t||"string"==typeof t),new Dc(t)},t}(),zl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Dc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Hl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new zl(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Dc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Wl(t,e,n){if(!n)throw new Br(jr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Yl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Br(jr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Xl(t,e,n,r){if(!0===e&&!0===r)throw new Br(jr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function $l(t){if(!Si.isDocumentKey(t))throw new Br(jr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function tf(t){if(Si.isDocumentKey(t))throw new Br(jr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ef(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Wr()}function nf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Br(jr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ef(t);throw new Br(jr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function rf(t,e){if(e<=0)throw new Br(jr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var of=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Br(jr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Br(jr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Xl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),sf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new of({}),this._settingsFrozen=!1,t instanceof jl?(this._databaseId=t,this._credentials=new Kl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Br(jr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jl(t.options.projectId)}(t),this._credentials=new Ql(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Br(jr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Br(jr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new of(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Kl;switch(t.type){case"gapi":var e=t.client;return Yr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Hl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Br(jr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Bl.get(this))&&(Jr("ComponentProvider","Removing Datastore"),Bl.delete(this),t.terminate()),Promise.resolve();var t},t}(),af=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new cf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),uf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),cf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,lo(r))||this)._path=r,i.type="collection",i}return(0,x.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new af(this.firestore,null,new Si(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(uf);function hf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,C.m9)(t),Wl("collection","path",e),t instanceof sf)return tf(n=hi.fromString.apply(hi,(0,x.ev)([e],r))),new cf(t,null,n);if(!(t instanceof af||t instanceof cf))throw new Br(jr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return tf(n=hi.fromString.apply(hi,(0,x.ev)([t.path],r)).child(hi.fromString(e))),new cf(t.firestore,null,n)}function lf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,C.m9)(t),1===arguments.length&&(e=ti.u()),Wl("doc","path",e),t instanceof sf)return $l(n=hi.fromString.apply(hi,(0,x.ev)([e],r))),new af(t,null,new Si(n));if(!(t instanceof af||t instanceof cf))throw new Br(jr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return $l(n=t._path.child(hi.fromString.apply(hi,(0,x.ev)([e],r)))),new af(t.firestore,t instanceof cf?t.converter:null,new Si(n))}function ff(t,e){return t=(0,C.m9)(t),e=(0,C.m9)(e),(t instanceof af||t instanceof cf)&&(e instanceof af||e instanceof cf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function df(t,e){return t=(0,C.m9)(t),e=(0,C.m9)(e),t instanceof uf&&e instanceof uf&&t.firestore===e.firestore&&To(t._query,e._query)&&t.converter===e.converter}var pf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Jc(this,"async_queue_retry"),this.Ic=function(){var e=Zc();e&&Jr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Zc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=Zc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Ma;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return(0,x.mG)(this,void 0,void 0,function(){var t,e=this;return(0,x.Jh)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ja(t=n.sent()))throw t;return Jr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Qr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=_h.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Wr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,x.mG)(this,void 0,void 0,function(){var t;return(0,x.Jh)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function gf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Ma,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var yf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new pf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,x.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||vf(this),this._firestoreClient.terminate()},e}(sf);function mf(t){return t._firestoreClient||vf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function vf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Gl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new kl(t._credentials,t._queue,r)}function wf(t,e,n){var r=this,i=new Ma;return t.asyncQueue.enqueue(function(){return(0,x.mG)(r,void 0,void 0,function(){var r;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,xl(t,n)];case 1:return o.sent(),[4,Cl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===jr.FAILED_PRECONDITION||t.code===jr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function bf(t){if(t._initialized||t._terminated)throw new Br(jr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Tf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Br(jr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new fi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),If=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(pi.fromBase64String(e))}catch(e){throw new Br(jr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(pi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Ef=function(t){this._methodName=t},_f=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Br(jr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Br(jr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return ei(this._lat,t._lat)||ei(this._long,t._long)},t}(),Sf=/^__.*__$/,Af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new $o(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xo(t,this.data,e,this.fieldTransforms)},t}(),Df=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new $o(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Nf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wr()}}var kf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return Hf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Nf(this.Nc)&&Sf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),xf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Kc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new kf({Nc:t,methodName:e,qc:n,path:fi.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Cf(t){var e=t._freezeSettings(),n=Kc(t._databaseId);return new xf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Rf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Kf("Data must be an object, but it was:",s,r);var a,u,c=Bf(r,s);if(o.merge)a=new di(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Jf(e,f[l],n);if(!s.contains(d))throw new Br(jr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Wf(h,d)||h.push(d)}a=new di(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Af(new Vi(c),a,u)}var Of=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Ef);function Lf(t,e,n){return new kf({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Pf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new jo(t.path,new Lo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Ef),Mf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,x.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=Lf(this,t,!0),n=this.Kc.map(function(t){return jf(t,e)}),r=new Po(n);return new jo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Ef),qf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,x.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=Lf(this,t,!0),n=this.Kc.map(function(t){return jf(t,e)}),r=new qo(n);return new jo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Ef),Ff=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,x.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new Uo(t.R,ko(t.R,this.Qc));return new jo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Ef);function Uf(t,e,n,r){var i=t.Uc(1,e,n);Kf("Data must be an object, but it was:",i,r);var o=[],s=Vi.empty();ai(r,function(t,r){var a=zf(e,t,n);r=(0,C.m9)(r);var u=i.Oc(a);if(r instanceof Of)o.push(a);else{var c=jf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new di(o);return new Df(s,a,i.fieldTransforms)}function Vf(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Jf(e,r,n)],u=[i];if(o.length%2!=0)throw new Br(jr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Jf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Vi.empty(),f=a.length-1;f>=0;--f)if(!Wf(h,a[f])){var d=a[f],p=u[f];p=(0,C.m9)(p);var g=s.Oc(d);if(p instanceof Of)h.push(d);else{var y=jf(p,g);null!=y&&(h.push(d),l.set(d,y))}}var m=new di(h);return new Df(l,m,s.fieldTransforms)}function Gf(t,e,n,r){return void 0===r&&(r=!1),jf(n,t.Uc(r?4:3,e))}function jf(t,e){if(Zf(t=(0,C.m9)(t)))return Kf("Unsupported field value:",e,t),Bf(t,e);if(t instanceof Ef)return function(t,e){if(!Nf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=jf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,C.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ko(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ii.fromDate(t);return{timestampValue:qs(e.R,n)}}if(t instanceof ii)return n=new ii(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:qs(e.R,n)};if(t instanceof _f)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof If)return{bytesValue:Fs(e.R,t._byteString)};if(t instanceof af){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Gs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+ef(t))}(t,e)}function Bf(t,e){var n={};return ui(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ai(t,function(t,r){var i=jf(r,e.Fc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Zf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ii||t instanceof _f||t instanceof If||t instanceof af||t instanceof Ef)}function Kf(t,e,n){if(!Zf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=ef(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function Jf(t,e,n){if((e=(0,C.m9)(e))instanceof Tf)return e._internalPath;if("string"==typeof e)return zf(t,e);throw Hf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Qf=new RegExp("[~\\*/\\[\\]]");function zf(t,e,n){if(e.search(Qf)>=0)throw Hf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Tf.bind.apply(Tf,(0,x.ev)([void 0],e.split(".")))))._internalPath}catch(Hd){throw Hf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Hf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Br(jr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Wf(t,e){return t.some(function(t){return t.isEqual(e)})}var Yf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new af(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Xf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field($f("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Yf);function $f(t,e){return"string"==typeof e?zf(t,e):e instanceof Tf?e._internalPath:e._delegate._internalPath}var td=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),ed=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,x.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new nd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field($f("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Yf),nd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(ed),rd=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new td(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new nd(n._firestore,n._userDataWriter,r.key,r,new td(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Br(jr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new nd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new td(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new nd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new td(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:id(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function id(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wr()}}function od(t,e){return t instanceof ed&&e instanceof ed?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof rd&&e instanceof rd&&t._firestore===e._firestore&&df(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function sd(t){if(po(t)&&0===t.explicitOrderBy.length)throw new Br(jr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ad=function(){};function ud(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var cd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,x.ZT)(e,t),e.prototype._apply=function(t){var e=Cf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Br(jr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){yd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(gd(r,t,h[c]));a={arrayValue:{values:u}}}else a=gd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||yd(s,o),a=Gf(n,"where",s,"in"===o||"not-in"===o);var l=zi.create(i,o,a);return function(t,e){if(e.g()){var n=yo(t);if(null!==n&&!n.isEqual(e.field))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=go(t);null!==r&&md(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Br(jr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new uf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(ad),hd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,x.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Br(jr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Br(jr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new oo(e,n);return function(t,e){if(null===go(t)){var n=yo(t);null!==n&&md(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new uf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new co(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(ad),ld=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,x.ZT)(e,t),e.prototype._apply=function(t){return new uf(t.firestore,t.converter,bo(t._query,this.Hc,this.Jc))},e}(ad),fd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,x.ZT)(e,t),e.prototype._apply=function(t){var e=pd(t,this.type,this.Yc,this.Xc);return new uf(t.firestore,t.converter,function(t,e){return new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(ad),dd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,x.ZT)(e,t),e.prototype._apply=function(t){var e=pd(t,this.type,this.Yc,this.Xc);return new uf(t.firestore,t.converter,function(t,e){return new co(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(ad);function pd(t,e,n,r){if(n[0]=(0,C.m9)(n[0]),n[0]instanceof Yf)return function(t,e,n,r,i){if(!r)throw new Br(jr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=vo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Oi(e,r.key));else{var c=r.data.field(u.field);if(wi(c))throw new Br(jr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Br(jr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new ro(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Cf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Br(jr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Br(jr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!mo(t)&&-1!==c.indexOf("/"))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(hi.fromString(c));if(!Si.isDocumentKey(h))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Si(h);a.push(Oi(e,l))}else{var f=Gf(n,r,c);a.push(f)}}return new ro(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function gd(t,e,n){if("string"==typeof(n=(0,C.m9)(n))){if(""===n)throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!mo(e)&&-1!==n.indexOf("/"))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(hi.fromString(n));if(!Si.isDocumentKey(r))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Oi(t,new Si(r))}if(n instanceof af)return Oi(t,n._key);throw new Br(jr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ef(n)+".")}function yd(t,e){if(!Array.isArray(t)||0===t.length)throw new Br(jr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Br(jr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function md(t,e,n){if(!n.isEqual(e))throw new Br(jr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var vd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ai(t)){case 0:return null;case 1:return t.booleanValue;case 2:return mi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(vi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Wr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return ai(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new _f(mi(t.latitude),mi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=bi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ti(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=yi(t);return new ii(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=hi.fromString(t);Yr(fa(n));var r=new jl(n.get(1),n.get(3)),i=new Si(n.popFirst(5));return r.isEqual(e)||Qr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function wd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var bd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,x.ZT)(e,t),e.prototype.convertBytes=function(t){return new If(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new af(this.firestore,null,e)},e}(vd),Td=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Cf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Id(t,this._firestore),i=wd(r.converter,e,n),o=Rf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Zo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Id(t,this._firestore);return o="string"==typeof(e=(0,C.m9)(e))||e instanceof Tf?Vf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Uf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Zo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Id(t,this._firestore);return this._mutations=this._mutations.concat(new os(e._key,Zo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Br(jr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Id(t,e){if((t=(0,C.m9)(t)).firestore!==e)throw new Br(jr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Ed=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,x.ZT)(e,t),e.prototype.convertBytes=function(t){return new If(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new af(this.firestore,null,e)},e}(vd);function _d(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=nf(t,af);var o=nf(t.firestore,yf),s=Cf(o);return Ad(o,[("string"==typeof(e=(0,C.m9)(e))||e instanceof Tf?Vf(s,"updateDoc",t._key,e,n,r):Uf(s,"updateDoc",t._key,e)).toMutation(t._key,Zo.exists(!0))])}function Sd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=(0,C.m9)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||gf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(gf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof af)c=nf(t.firestore,yf),h=lo(t._key.path),u={next:function(e){i[a]&&i[a](Dd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=nf(t,uf);c=nf(d.firestore,yf),h=d._query;var p=new Ed(c);u={next:function(t){i[a]&&i[a](new rd(c,p,d,t))},error:i[a+1],complete:i[a+2]},sd(t._query)}return function(t,e,n,r){var i=this,o=new Al(r),s=new Mh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(i,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e=Ch,[4,Fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(i,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e=Rh,[4,Fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(mf(c),h,l,u)}function Ad(t,e){return function(t,e){var n=this,r=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var n;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return n=zh,[4,ql(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(mf(t),e)}function Dd(t,e,n){var r=n.docs.get(e._key),i=new Ed(t);return new ed(t,i,e._key,r,new td(n.hasPendingWrites,n.fromCache),e.converter)}var Nd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,x.ZT)(e,t),e.prototype.get=function(e){var n=this,r=Id(e,this._firestore),i=new Ed(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new ed(n._firestore,i,r._key,t._document,new td(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Cf(t)}return t.prototype.get=function(t){var e=this,n=Id(t,this._firestore),r=new bd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Wr();var i=t[0];if(i.isFoundDocument())return new Yf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Yf(e._firestore,r,n._key,null,n.converter);throw Wr()})},t.prototype.set=function(t,e,n){var r=Id(t,this._firestore),i=wd(r.converter,e,n),o=Rf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Id(t,this._firestore);return o="string"==typeof(e=(0,C.m9)(e))||e instanceof Tf?Vf(this._dataReader,"Transaction.update",s._key,e,n,r):Uf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Id(t,this._firestore);return this._transaction.delete(e._key),this},t}());function kd(){if("undefined"==typeof Uint8Array)throw new Br(jr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function xd(){if("undefined"==typeof atob)throw new Br(jr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Cd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return xd(),new t(If.fromBase64String(e))},t.fromUint8Array=function(e){return kd(),new t(If.fromUint8Array(e))},t.prototype.toBase64=function(){return xd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return kd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Rd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){bf(t=nf(t,yf));var n=mf(t),r=t._freezeSettings(),i=new Sl;return wf(n,i,new El(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){bf(t=nf(t,yf));var e=mf(t),n=t._freezeSettings(),r=new Sl;return wf(e,r,new _l(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Br(jr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ma;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,x.mG)(e,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,x.mG)(this,void 0,void 0,function(){return(0,x.Jh)(this,function(e){switch(e.label){case 0:return Ua.yt()?[4,Ua.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Wu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Od=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof jl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||zr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=nf(t,sf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&zr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=(0,C.Sg)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Br(jr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Jl(new Zl(o,new Dc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,x.mG)(e,void 0,void 0,function(){var e,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return[4,Ll(t)];case 1:return e=r.sent(),[4,Ml(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Xr(t);return e.Or.delete(0),$c(e)}(n))]}})})})}(mf(nf(this._delegate,yf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,x.mG)(e,void 0,void 0,function(){var e,n;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return[4,Ll(t)];case 1:return e=r.sent(),[4,Ml(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,x.mG)(this,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return(e=Xr(t)).Or.add(0),[4,th(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(mf(nf(this._delegate,yf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Xl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(e,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(r){switch(r.label){case 0:return e=tl,[4,ql(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(mf(nf(this._delegate,yf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Al(e);return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.add(e),e.next()},[4,Fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var e;return(0,x.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.delete(e)},[4,Fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(mf(t=nf(t,yf)),gf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new Br(jr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Qd(this,hf(this._delegate,t))}catch(t){throw Ud(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Fd(this,lf(this._delegate,t))}catch(t){throw Ud(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Zd(this,function(t,e){if(t=nf(t,sf),Wl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Br(jr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new uf(t,null,function(t){return new co(hi.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Ud(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var n;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return[4,function(t){return Ol(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Nl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(mf(t),function(n){return e(new Nd(t,n))})}(this._delegate,function(n){return t(new Pd(e,n))})},t.prototype.batch=function(){var t=this;return mf(this._delegate),new Md(new Td(this._delegate,function(e){return Ad(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Br(jr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Br(jr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Ld=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,x.ZT)(e,t),e.prototype.convertBytes=function(t){return new Cd(new If(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Fd.eu(e,this.firestore,null)},e}(vd),Pd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.prototype.get=function(t){var e=this,n=zd(t);return this._delegate.get(n).then(function(t){return new jd(e._firestore,new ed(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=zd(t);return n?(Yl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,x.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=zd(t);return this._delegate.delete(e),this},t}(),Md=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=zd(t);return n?(Yl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,x.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=zd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),qd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new nd(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Bd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Ld(e),n),i.set(n,o)),o},t}();qd.su=new WeakMap;var Fd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new Br(jr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new af(n._delegate,r,new Si(e)))},t.eu=function(e,n,r){return new t(n,new af(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Qd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Qd(this.firestore,hf(this._delegate,t))}catch(t){throw Ud(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,C.m9)(t))instanceof af&&ff(this._delegate,t)},t.prototype.set=function(t,e){e=Yl("DocumentReference.set",e);try{return function(t,e,n){t=nf(t,af);var r=nf(t.firestore,yf),i=wd(t.converter,e,n);return Ad(r,[Rf(Cf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Zo.none())])}(this._delegate,t,e)}catch(t){throw Ud(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?_d(this._delegate,t):_d.apply(void 0,(0,x.ev)([this._delegate,t,e],n))}catch(t){throw Ud(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Ad(nf((t=this._delegate).firestore,yf),[new os(t._key,Zo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Vd(e),i=Gd(e,function(e){return new jd(t.firestore,new ed(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Sd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=nf(t,af);var e=nf(t.firestore,yf),n=mf(e),r=new Ed(e);return function(t,e){var n=this,r=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var n;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i;return(0,x.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Br(jr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Sh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Pl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new ed(e,r,t._key,n,new td(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=nf(t,af);var e=nf(t.firestore,yf);return Ul(mf(e),t._key,{source:"server"}).then(function(n){return Dd(e,t,n)})}(this._delegate):function(t){t=nf(t,af);var e=nf(t.firestore,yf);return Ul(mf(e),t._key).then(function(n){return Dd(e,t,n)})}(this._delegate)).then(function(t){return new jd(e.firestore,new ed(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?qd.nu(this.firestore,e):null))},t}();function Ud(t,e,n){return t.message=t.message.replace(e,n),t}function Vd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!gf(r))return r}return{}}function Gd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=gf(t[0])?t[0]:gf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var jd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Fd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return od(this._delegate,t._delegate)},t}(),Bd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,x.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(jd),Zd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Ld(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,ud(this._delegate,function(t,e,n){var r=e,i=$f("where",t);return new cd(i,r,n)}(e,n,r)))}catch(e){throw Ud(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,ud(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=$f("orderBy",t);return new hd(r,n)}(e,n)))}catch(e){throw Ud(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,ud(this._delegate,function(t){return rf("limit",t),new ld("limit",t,"F")}(e)))}catch(e){throw Ud(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,ud(this._delegate,function(t){return rf("limitToLast",t),new ld("limitToLast",t,"L")}(e)))}catch(e){throw Ud(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ud(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new fd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Ud(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ud(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new fd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Ud(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ud(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Ud(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ud(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Ud(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return df(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=nf(t,uf);var e=nf(t.firestore,yf),n=mf(e),r=new Ed(e);return function(t,e){var n=this,r=new Ma;return t.asyncQueue.enqueueAndForget(function(){return(0,x.mG)(n,void 0,void 0,function(){var n;return(0,x.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,x.mG)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,x.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,lc(t,e,!0)];case 1:return a=u.sent(),r=new Gh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Sh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Pl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new rd(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=nf(t,uf);var e=nf(t.firestore,yf),n=mf(e),r=new Ed(e);return Vl(n,t._query,{source:"server"}).then(function(n){return new rd(e,r,t,n)})}(this._delegate):function(t){t=nf(t,uf);var e=nf(t.firestore,yf),n=mf(e),r=new Ed(e);return sd(t._query),Vl(n,t._query).then(function(n){return new rd(e,r,t,n)})}(this._delegate)).then(function(t){return new Jd(e.firestore,new rd(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Vd(e),i=Gd(e,function(e){return new Jd(t.firestore,new rd(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Sd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?qd.nu(this.firestore,e):null))},t}(),Kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Bd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Jd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Zd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Bd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Kd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Bd(n._firestore,r))})},t.prototype.isEqual=function(t){return od(this._delegate,t._delegate)},t}(),Qd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,x.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Fd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Fd(this.firestore,void 0===t?lf(this._delegate):lf(this._delegate,t))}catch(t){throw Ud(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=nf(t.firestore,yf),r=lf(t),i=wd(t.converter,e);return Ad(n,[Rf(Cf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Zo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Fd(e.firestore,t)})},e.prototype.isEqual=function(t){return ff(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?qd.nu(this.firestore,t):null))},e}(Zd);function zd(t){return nf(t,af)}var Hd,Wd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Tf.bind.apply(Tf,(0,x.ev)([void 0],t)))}return t.documentId=function(){return new t(fi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,C.m9)(t))instanceof Tf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Yd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Pf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Of("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Mf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Ff("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Xd=n(5119),$d={Firestore:Od,GeoPoint:_f,Timestamp:ii,Blob:Cd,Transaction:Pd,WriteBatch:Md,DocumentReference:Fd,DocumentSnapshot:jd,Query:Zd,QueryDocumentSnapshot:Bd,QuerySnapshot:Jd,CollectionReference:Qd,FieldPath:Wd,FieldValue:Yd,setLogLevel:function(t){Zr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Xd.wA("firestore",function(t){return function(t,e){return new Od(t,new yf(t,e),new Rd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},$d)))})(Hd=k.Z),Hd.registerVersion("@firebase/firestore","2.3.10");var tp=n(1428);function ep(t,e){return function(t,e=y.z){return new m.y(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function np(t,e){return ep(t,e).pipe((0,I.U)(t=>({payload:t,type:"query"})))}function rp(t,e){return np(t,e).pipe((0,b.O)(void 0),(0,T.G)(),(0,I.U)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function ip(t,e,n){return rp(t,n).pipe((0,E.R)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return op(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return op(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return op(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),(0,_.x)(),(0,I.U)(t=>t.map(t=>({type:t.type,payload:t}))))}function op(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function sp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class ap{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=rp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe((0,I.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe((0,b.O)(void 0),(0,T.G)(),(0,S.h)(([t,e])=>e.length>0||!t),(0,I.U)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,E.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=sp(t);return ip(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return np(this.query,this.afs.schedulers.outsideAngular).pipe((0,I.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,v.D)(this.query.get(t)).pipe((0,A.QV)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new up(this.ref.doc(t),this.afs)}}class up{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=pp(n,e);return new ap(r,i,this.afs)}snapshotChanges(){return ep(this.ref,this.afs.schedulers.outsideAngular).pipe((0,b.O)(void 0),(0,T.G)(),(0,I.U)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe((0,I.U)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return(0,v.D)(this.ref.get(t)).pipe((0,A.QV)(this.afs.schedulers.insideAngular))}}class cp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?rp(this.query,this.afs.schedulers.outsideAngular).pipe((0,I.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)),(0,S.h)(t=>t.length>0),this.afs.keepUnstableUntilFirst):rp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,E.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=sp(t);return ip(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return np(this.query,this.afs.schedulers.outsideAngular).pipe((0,I.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,v.D)(this.query.get(t)).pipe((0,A.QV)(this.afs.schedulers.insideAngular))}}const hp=new i.OlP("angularfire2.enableFirestorePersistence"),lp=new i.OlP("angularfire2.firestore.persistenceSettings"),fp=new i.OlP("angularfire2.firestore.settings"),dp=new i.OlP("angularfire2.firestore.use-emulator");function pp(t,e=(t=>t)){return{query:e(t),ref:t}}let gp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new D.HU(s),this.keepUnstableUntilFirst=(0,D.ss)(this.schedulers);const h=(0,D.on)(t,s,e);!N.Z.auth&&c&&(0,D.yq)();const l=u;[this.firestore,this.persistenceEnabled$]=(0,D.sI)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!(0,r.PM)(o)){const e=()=>{try{return(0,v.D)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(Hd){return"undefined"!=typeof console&&console.warn(Hd),(0,w.of)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,(0,w.of)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=pp(n,e),o=this.schedulers.ngZone.run(()=>r);return new ap(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new cp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new up(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(D.Dh),i.LFG(D.xv,8),i.LFG(hp,8),i.LFG(fp,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(lp,8),i.LFG(dp,8),i.LFG(tp.Qv,8))},t.\u0275prov=i.Yz7({factory:function(){return new t(i.LFG(D.Dh),i.LFG(D.xv,8),i.LFG(hp,8),i.LFG(fp,8),i.LFG(i.Lbi),i.LFG(i.R0b),i.LFG(lp,8),i.LFG(dp,8),i.LFG(tp.Qv,8))},token:t,providedIn:"any"}),t})();var yp=n(3070),mp=n(9550),vp=n(1041);let wp=(()=>{class t{constructor(t,e,n,r){this.dialogRef=t,this.data=e,this.db=n,this.auth=r,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("I_Apotek").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat menyimpan data")})}else(new Date).getTime().toString(),this.data.uid=this.userData.uid,this.db.collection("I_Apotek").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Tidak dapat mengupdate data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(g.so),i.Y36(g.WI),i.Y36(gp),i.Y36(tp.zQ))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-product-detail"]],decls:44,vars:11,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","","type","number",3,"ngModel","ngModelChange"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","type","date",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(i.TgZ(0,"h3",0),i._uU(1," Detail Data Penduduk "),i.qZA(),i.TgZ(2,"div",1),i.TgZ(3,"mat-form-field",2),i.TgZ(4,"mat-label"),i._uU(5,"NIK"),i.qZA(),i.TgZ(6,"input",3),i.NdJ("ngModelChange",function(t){return e.data.Obat=t}),i.qZA(),i.qZA(),i.TgZ(7,"mat-form-field",2),i.TgZ(8,"mat-label"),i._uU(9,"NAMA"),i.qZA(),i.TgZ(10,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Golongan=t}),i.qZA(),i.qZA(),i.TgZ(11,"mat-form-field",2),i.TgZ(12,"mat-label"),i._uU(13,"ALAMAT"),i.qZA(),i.TgZ(14,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Satuan=t}),i.qZA(),i.qZA(),i.TgZ(15,"mat-form-field",2),i.TgZ(16,"mat-label"),i._uU(17,"JENIS KELAMIN"),i.qZA(),i.TgZ(18,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Tanggal_Masuk=t}),i.qZA(),i.qZA(),i.TgZ(19,"mat-form-field",2),i.TgZ(20,"mat-label"),i._uU(21,"TEMPAT LAHIR"),i.qZA(),i.TgZ(22,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Ex=t}),i.qZA(),i.qZA(),i.TgZ(23,"mat-form-field",2),i.TgZ(24,"mat-label"),i._uU(25,"TANGGAL LAHIR"),i.qZA(),i.TgZ(26,"input",5),i.NdJ("ngModelChange",function(t){return e.data.Harga=t}),i.qZA(),i.qZA(),i.TgZ(27,"mat-form-field",2),i.TgZ(28,"mat-label"),i._uU(29,"STATUS PERKAWINAN"),i.qZA(),i.TgZ(30,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Jumlah_masuk=t}),i.qZA(),i.qZA(),i.TgZ(31,"mat-form-field",2),i.TgZ(32,"mat-label"),i._uU(33,"KEWARGANEGARAAN"),i.qZA(),i.TgZ(34,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Jumlah_keluar=t}),i.qZA(),i.qZA(),i.TgZ(35,"mat-form-field",2),i.TgZ(36,"mat-label"),i._uU(37,"MASABERLAKU"),i.qZA(),i.TgZ(38,"input",4),i.NdJ("ngModelChange",function(t){return e.data.Sisa=t}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(39,"div",6),i.TgZ(40,"button",7),i._uU(41,"Batal"),i.qZA(),i.TgZ(42,"button",8),i.NdJ("click",function(){return e.saveData()}),i._uU(43),i.qZA(),i.qZA()),2&t&&(i.xp6(6),i.Q6J("ngModel",e.data.Obat),i.xp6(4),i.Q6J("ngModel",e.data.Golongan),i.xp6(4),i.Q6J("ngModel",e.data.Satuan),i.xp6(4),i.Q6J("ngModel",e.data.Tanggal_Masuk),i.xp6(4),i.Q6J("ngModel",e.data.Ex),i.xp6(4),i.Q6J("ngModel",e.data.Harga),i.xp6(4),i.Q6J("ngModel",e.data.Jumlah_masuk),i.xp6(4),i.Q6J("ngModel",e.data.Jumlah_keluar),i.xp6(4),i.Q6J("ngModel",e.data.Sisa),i.xp6(4),i.Q6J("disabled",e.loading),i.xp6(1),i.Oqu(e.loading?"Menyimpan..":"Simpan"))},directives:[g.uh,g.xY,yp.KE,yp.hX,mp.Nt,vp.wV,vp.Fj,vp.JJ,vp.On,g.H8,u.lW,g.ZT],styles:[""]}),t})();var bp=n(7672),Tp=n(2797);function Ip(t,e){1&t&&(i.TgZ(0,"div",2),i._UZ(1,"mat-spinner"),i.qZA())}function Ep(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"tr"),i.TgZ(1,"td"),i._uU(2),i.qZA(),i.TgZ(3,"td"),i._uU(4),i.qZA(),i.TgZ(5,"td"),i._uU(6),i.qZA(),i.TgZ(7,"td"),i._uU(8),i.qZA(),i.TgZ(9,"td"),i._uU(10),i.qZA(),i.TgZ(11,"td"),i._uU(12),i.qZA(),i.TgZ(13,"td"),i._uU(14),i.qZA(),i.TgZ(15,"td"),i._uU(16),i.qZA(),i.TgZ(17,"td"),i._uU(18),i.qZA(),i.TgZ(19,"td"),i._uU(20),i.qZA(),i.TgZ(21,"td",7),i.TgZ(22,"button",9),i.NdJ("click",function(){const e=i.CHM(t),n=e.$implicit,r=e.index;return i.oxw(2).productDetail(n,r)}),i._uU(23,"Edit"),i.qZA(),i.TgZ(24,"button",10),i.NdJ("click",function(){const e=i.CHM(t),n=e.$implicit,r=e.index;return i.oxw(2).deleteProduct(n.id,r)}),i._uU(25),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=e.$implicit,n=e.index,r=i.oxw(2);i.xp6(2),i.Oqu(n+1),i.xp6(2),i.Oqu(t.Obat),i.xp6(2),i.Oqu(t.Golongan),i.xp6(2),i.Oqu(t.Satuan),i.xp6(2),i.Oqu(t.Tanggal_Masuk),i.xp6(2),i.Oqu(t.Ex),i.xp6(2),i.Oqu(t.Harga),i.xp6(2),i.Oqu(t.Jumlah_masuk),i.xp6(2),i.Oqu(t.Jumlah_keluar),i.xp6(2),i.Oqu(t.Sisa),i.xp6(4),i.Q6J("disabled",r.loadingDelete[n]),i.xp6(1),i.Oqu(r.loadingDelete[n]?"Deleting..":"Delete")}}function _p(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"mat-card"),i.TgZ(1,"mat-card-header"),i.TgZ(2,"mat-card-title"),i._uU(3),i.qZA(),i.qZA(),i.TgZ(4,"mat-card-content"),i.TgZ(5,"div",3),i._UZ(6,"span",4),i.TgZ(7,"button",5),i.NdJ("click",function(){return i.CHM(t),i.oxw().productDetail({},-1)}),i._uU(8,"Tambah Data Penduduk"),i.qZA(),i.qZA(),i.TgZ(9,"table",6),i.TgZ(10,"thead"),i.TgZ(11,"th"),i._uU(12,"No"),i.qZA(),i.TgZ(13,"th"),i._uU(14,"NIK"),i.qZA(),i.TgZ(15,"th"),i._uU(16,"NAMA"),i.qZA(),i.TgZ(17,"th"),i._uU(18,"ALAMAT"),i.qZA(),i.TgZ(19,"th"),i._uU(20,"JENIS KELAMIN"),i.qZA(),i.TgZ(21,"th"),i._uU(22,"TEMPAT LAHIR"),i.qZA(),i.TgZ(23,"th"),i._uU(24,"TANGGAL LAHIR"),i.qZA(),i.TgZ(25,"th"),i._uU(26,"STATUS PERKAWINAN"),i.qZA(),i.TgZ(27,"th"),i._uU(28,"KEWARGANEGARAAN"),i.qZA(),i.TgZ(29,"th"),i._uU(30,"MASABERLAKU"),i.qZA(),i._UZ(31,"th",7),i.qZA(),i.TgZ(32,"tbody"),i.YNc(33,Ep,26,12,"tr",8),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&t){const t=i.oxw();i.xp6(3),i.Oqu(t.title),i.xp6(30),i.Q6J("ngForOf",t.I_Apotek)}}const Sp=[{path:"",component:d,children:[{path:"dashboard",component:o},{path:"product",component:(()=>{class t{constructor(t,e,n){this.dialog=t,this.db=e,this.auth=n,this.Obat={},this.I_Apotek={},this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Data Penduduk",this.auth.user.subscribe(t=>{this.userData=t,this.getI_Apotek()})}getI_Apotek(){this.loading=!0,this.db.collection("I_Apotek",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.I_Apotek=t,this.loading=!1},t=>{this.loading=!1})}productDetail(t,e){this.dialog.open(wp,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}deleteProduct(t,e){confirm("Delete Item?")&&this.db.collection("I_Apotek").doc(t).delete().then(t=>{this.I_Apotek.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Tidak dapat menghapus data")})}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(g.uw),i.Y36(gp),i.Y36(tp.zQ))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-product"]],decls:2,vars:2,consts:[["style","height: 300px","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],[4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","warn",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","right"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"disabled","click"]],template:function(t,e){1&t&&(i.YNc(0,Ip,2,0,"div",0),i.YNc(1,_p,34,2,"mat-card",1)),2&t&&(i.Q6J("ngIf",e.loading),i.xp6(1),i.Q6J("ngIf",!e.loading))},directives:[r.O5,bp.$g,Tp.a8,Tp.dk,Tp.n5,Tp.dn,u.lW,r.sg],styles:[""]}),t})()},{path:"tentang",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-dashboard"]],decls:8,vars:0,consts:[["src","https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31717.581574615633!2d106.95015038889625!3d-6.432864556497194!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6995a385eb5a03%3A0xa4116e10b8ed9203!2sDayeuh%2C%20Kec.%20Cileungsi%2C%20Bogor%2C%20Jawa%20Barat!5e0!3m2!1sid!2sid!4v1624883125165!5m2!1sid!2sid","width","1250","height","450","allowfullscreen","","loading","lazy",2,"border","0"]],template:function(t,e){1&t&&(i.TgZ(0,"html"),i.TgZ(1,"head"),i._UZ(2,"title"),i.qZA(),i.TgZ(3,"body"),i.TgZ(4,"h4"),i._uU(5,"selamat datang di web aplikasi pendades (pendataan penduduk desa)"),i.qZA(),i._UZ(6,"br"),i._UZ(7,"iframe",0),i.qZA(),i.qZA())},styles:[""]}),t})()},{path:"",redirectTo:"/admin/dashboar",pathMatch:"full"}]}];let Ap=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[r.ez,s.Bz.forChild(Sp),p.M,vp.u5]]}),t})()}}]);